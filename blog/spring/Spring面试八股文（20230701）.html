<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html {
	font-size: 19px;
}

html, body {
	margin: auto;
	background: #fefefe;
	-webkit-font-smoothing: antialiased;
}
body {
	font-family: "Vollkorn", Palatino, Times;
	color: #333;
	line-height: 1.4;
	text-align: justify;
}

#write {
	max-width: 960px;
	margin: 0 auto;
	margin-bottom: 2em;
	line-height: 1.53;
	padding-top: 40px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1100px;
	}
}

@media print {
	html {
		font-size: 13px;
	}
}

/* Typography
-------------------------------------------------------- */

#write>h1:first-child,
h1 {
	margin-top: 1.6em;
	font-weight: normal;
}

h1 {
	font-size:3em;
}

h2 {
	margin-top:2em;
	font-weight: normal;
}

h3 {
	font-weight: normal;
	font-style: italic;
	margin-top: 3em;
}

h1, 
h2, 
h3{
	text-align: center;
}

h2:after{
	border-bottom: 1px solid #2f2f2f;
    content: '';
    width: 100px;
    display: block;
    margin: 0 auto;
    height: 1px;
}

h1+h2, h2+h3 {
	margin-top: 0.83em;
}

p,
.mathjax-block {
	margin-top: 0;
	-webkit-hypens: auto;
	-moz-hypens: auto;
	hyphens: auto;
}
ul {
	list-style: square;
	padding-left: 1.2em;
}
ol {
	padding-left: 1.2em;
}
blockquote {
	margin-left: 1em;
	padding-left: 1em;
	border-left: 1px solid #ddd;
}
code,
pre {
	font-family: "Consolas", "Menlo", "Monaco", monospace, serif;
	font-size: .9em;
	background: white;
}
.md-fences{
	margin-left: 1em;
	padding-left: 1em;
	border: 1px solid #ddd;
	padding-bottom: 8px;
	padding-top: 6px;
	margin-bottom: 1.5em;
}

a {
	color: #2484c1;
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
a img {
	border: none;
}
h1 a,
h1 a:hover {
	color: #333;
	text-decoration: none;
}
hr {
	color: #ddd;
	height: 1px;
	margin: 2em 0;
	border-top: solid 1px #ddd;
	border-bottom: none;
	border-left: 0;
	border-right: 0;
}
.ty-table-edit {
	background: #ededed;
    padding-top: 4px;
}
table {
	margin-bottom: 1.333333rem
}
table th,
table td {
	padding: 8px;
	line-height: 1.333333rem;
	vertical-align: top;
	border-top: 1px solid #ddd
}
table th {
	font-weight: bold
}
table thead th {
	vertical-align: bottom
}
table caption+thead tr:first-child th,
table caption+thead tr:first-child td,
table colgroup+thead tr:first-child th,
table colgroup+thead tr:first-child td,
table thead:first-child tr:first-child th,
table thead:first-child tr:first-child td {
	border-top: 0
}
table tbody+tbody {
	border-top: 2px solid #ddd
}

.task-list{
	padding:0;
}

.md-task-list-item {
	padding-left: 1.6rem;
}

.md-task-list-item > input:before {
	content: '\221A';
	display: inline-block;
	width: 1.33333333rem;
  	height: 1.6rem;
	vertical-align: middle;
	text-align: center;
	color: #ddd;
	background-color: #fefefe;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before{
	color: inherit;
}
.md-tag {
	color: inherit;
	font: inherit;
}
#write pre.md-meta-block {
	min-height: 35px;
	padding: 0.5em 1em;
}
#write pre.md-meta-block {
	white-space: pre;
	background: #f8f8f8;
	border: 0px;
	color: #999;
	
	width: 100vw;
	max-width: calc(100% + 60px);
	margin-left: -30px;
	border-left: 30px #f8f8f8 solid;
	border-right: 30px #f8f8f8 solid;

	margin-bottom: 2em;
	margin-top: -1.3333333333333rem;
	padding-top: 26px;
	padding-bottom: 10px;
	line-height: 1.8em;
	font-size: 0.9em;
	font-size: 0.76em;
	padding-left: 0;
}
.md-img-error.md-image>.md-meta{
	vertical-align: bottom;
}
#write>h5.md-focus:before {
	top: 2px;
}

.md-toc {
	margin-top: 40px;
}

.md-toc-content {
	padding-bottom: 20px;
}

.outline-expander:before {
	color: inherit;
	font-size: 14px;
	top: auto;
	content: "\f0da";
	font-family: FontAwesome;
}

.outline-expander:hover:before,
.outline-item-open>.outline-item>.outline-expander:before {
  	content: "\f0d7";
}

/** source code mode */
#typora-source {
	font-family: Courier, monospace;
    color: #6A6A6A;
}

.html-for-mac #typora-sidebar {
    -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
    box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
}

.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property,
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor {
	color: #428bca;
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
	color: #777777;
}

.typora-node .file-list-item-parent-loc, 
.typora-node .file-list-item-time, 
.typora-node .file-list-item-summary {
	font-family: arial, sans-serif;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: calc(1rem - 12px);
}

.md-mathjax-midline {
	background: #fafafa;
}

.md-fences .code-tooltip {
	bottom: -2em !important;
}

.dropdown-menu .divider {
	border-color: #e5e5e5;
}


</style><title>Spring面试八股文（20230701）</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='spring面试八股文20230701）'><span>Spring面试八股文（20230701）</span></h1><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" href="#spring面试八股文20230701）">Spring面试八股文（20230701）</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" href="#1-spring-ioc">1 Spring IOC</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n5"><a class="md-toc-inner" href="#11-控制翻转和面向切面">1.1 控制翻转和面向切面</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n29"><a class="md-toc-inner" href="#12-spring有哪些优点呢">1.2 Spring有哪些优点呢？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n55"><a class="md-toc-inner" href="#13-spring有哪些模块">1.3 Spring有哪些模块?</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n88"><a class="md-toc-inner" href="#14-spring常见注解">1.4 Spring常见注解</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n152"><a class="md-toc-inner" href="#15-spring中应用了哪些设计模式">1.5 Spring中应用了哪些设计模式？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n169"><a class="md-toc-inner" href="#16-什么是ioc什么是di">1.6 什么是IOC？什么是DI？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n180"><a class="md-toc-inner" href="#17-spring-ioc的实现机制">1.7 Spring IOC的实现机制</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n210"><a class="md-toc-inner" href="#171-写个mini版本的spring-ioc">1.7.1 写个mini版本的Spring IOC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n273"><a class="md-toc-inner" href="#172-拓展">1.7.2 拓展</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n332"><a class="md-toc-inner" href="#18-什么是beanfactory和applicationcontext">1.8 什么是BeanFactory和ApplicationContext?</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n360"><a class="md-toc-inner" href="#19-spring-容器启动阶段会干什么">1.9 Spring 容器启动阶段会干什么？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n389"><a class="md-toc-inner" href="#110-spring-bean的生命周期">1.10 Spring Bean的生命周期</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n411"><a class="md-toc-inner" href="#111-bean定义和依赖定义有哪些">1.11 Bean定义和依赖定义有哪些？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n456"><a class="md-toc-inner" href="#112-有哪些依赖注入的方法">1.12 有哪些依赖注入的方法？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n460"><a class="md-toc-inner" href="#113-spring-有哪些自动装配的方式">1.13 Spring 有哪些自动装配的方式？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n495"><a class="md-toc-inner" href="#114-spring中的bean的作用域">1.14 Spring中的Bean的作用域</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n511"><a class="md-toc-inner" href="#115-spring中的单例bean会存在线程安全问题吗">1.15 Spring中的单例Bean会存在线程安全问题吗？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n542"><a class="md-toc-inner" href="#116-spring怎么解决循环依赖">1.16 Spring怎么解决循环依赖</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n577"><a class="md-toc-inner" href="#118-为什么要三级缓存二级不行吗">1.18 为什么要三级缓存？二级不行吗？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n582"><a class="md-toc-inner" href="#119-autowired的实现原理">1.19 @Autowired的实现原理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n594"><a class="md-toc-inner" href="#2-spring-aop">2 Spring AOP</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n595"><a class="md-toc-inner" href="#21-什么是aop">2.1 什么是AOP?</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n727"><a class="md-toc-inner" href="#22-什么是jdk动态代理和cglib代理">2.2 什么是JDK动态代理和CGLIB代理？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n776"><a class="md-toc-inner" href="#23-spring-aop和aspectj-aop区别">2.3 Spring AOP和AspectJ AOP区别？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n801"><a class="md-toc-inner" href="#3-事务">3 事务</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n803"><a class="md-toc-inner" href="#31-事务的种类">3.1 事务的种类</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n818"><a class="md-toc-inner" href="#32-spring的事务隔离级别">3.2 Spring的事务隔离级别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n831"><a class="md-toc-inner" href="#33-spring-的事务传播机制">3.3 Spring 的事务传播机制？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n853"><a class="md-toc-inner" href="#34-声明式事务实现原理">3.4 声明式事务实现原理</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n870"><a class="md-toc-inner" href="#35-声明式事务在哪种情况下会失效">3.5 声明式事务在哪种情况下会失效？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n943"><a class="md-toc-inner" href="#4-mvc">4 MVC</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n944"><a class="md-toc-inner" href="#41-spring-mvc的核心组件">4.1 Spring MVC的核心组件</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n981"><a class="md-toc-inner" href="#42-spring-mvc-的工作流程">4.2 Spring MVC 的工作流程？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1000"><a class="md-toc-inner" href="#43-springmvc-restful-风格的接口的流程是什么样的呢">4.3 SpringMVC Restful 风格的接口的流程是什么样的呢？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1023"><a class="md-toc-inner" href="#5-spring-boot">5 Spring Boot</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1025"><a class="md-toc-inner" href="#51-spring-boot是什么有哪些优点">5.1 Spring Boot是什么？有哪些优点？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1063"><a class="md-toc-inner" href="#52-springboot-自动配置原理了解吗">5.2 SpringBoot 自动配置原理了解吗？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1101"><a class="md-toc-inner" href="#53-springboot-启动原理">5.3 Springboot 启动原理</a></span></p></div><p>&nbsp;</p><h2 id='1-spring-ioc'><span>1 Spring IOC</span></h2><h3 id='11-控制翻转和面向切面'><span>1.1 控制翻转和面向切面</span></h3><p><span>控制反转（Inversion of Control，简称IoC）和面向切面编程（Aspect-Oriented Programming，简称AOP）是Spring框架的两个重要概念和特性。</span></p><ol start='' ><li><p><span>控制反转（IoC）：</span></p><ul><li><span>IoC是一种设计原则，也是Spring框架的核心理念之一。它将对象的创建、依赖关系的管理和调用的控制权从应用程序代码中转移到框架或容器中，实现了对象的解耦和灵活性。</span></li><li><span>在传统的编程模型中，对象之间的依赖关系由对象自身负责管理和创建，而在IoC容器中，对象的创建和依赖关系由容器负责，应用程序只需要声明依赖关系，由容器进行注入。</span></li><li><span>Spring框架通过依赖注入（Dependency Injection）实现了IoC，提供了多种依赖注入的方式，如构造函数注入、Setter方法注入、接口注入等。这样可以实现松耦合的组件之间的协作。</span></li></ul></li><li><p><span>面向切面编程（AOP）：</span></p><ul><li><span>AOP是一种编程范式，用于将横切逻辑（Cross-Cutting Concerns）与核心业务逻辑分离，并通过切面（Aspect）将横切逻辑模块化，减少代码的重复和耦合。</span></li><li><span>在传统的编程模型中，横切逻辑（如日志记录、事务管理、安全检查等）会散布在多个业务逻辑中，导致代码的冗余和复杂性。而通过AOP，可以将这些横切逻辑从业务逻辑中抽离出来，形成独立的切面模块。</span></li><li><span>Spring框架提供了AOP的支持，可以通过使用切面（Aspect）和通知（Advice）来实现横切逻辑的模块化。切面定义了横切逻辑的内容，而通知定义了在何时、何地应用切面。通过将通知织入到目标对象中，可以实现对目标方法的增强或拦截。</span></li><li><span>Spring AOP基于动态代理技术，可以在运行时生成代理对象，拦截目标方法的调用，并在调用前后执行额外的横切逻辑。</span></li></ul></li></ol><p><span>总结起来，控制反转（IoC）和面向切面编程（AOP）是Spring框架的两个关键概念。IoC实现了对象的解耦和依赖关系的管理，通过依赖注入实现了对象之间的协作；而AOP（面向切面编程）将横切逻辑与核心业务逻辑分离，使得横切逻辑可以独立于核心业务逻辑进行开发、维护和重用。</span></p><h3 id='12-spring有哪些优点呢'><span>1.2 Spring有哪些优点呢？</span></h3><p><img src="Spring面试八股文（20230701）.assets/spring-a0f0ef9d-3289-41ea-94c2-34b7e37ef854.png" referrerpolicy="no-referrer" alt="Spring特性"></p><ol start='' ><li><strong><span>IOC</span></strong><span> 和 </span><strong><span>DI</span></strong><span> 的支持</span></li></ol><p><span>Spring 的核心就是一个大的工厂容器，可以维护所有对象的创建和依赖关系，Spring 工厂用于生成 Bean，并且管理 Bean 的生命周期，实现</span><strong><span>高内聚低耦合</span></strong><span>的设计理念。</span></p><ol start='' ><li><span>AOP 编程的支持</span></li></ol><p><span>Spring 提供了</span><strong><span>面向切面编程</span></strong><span>，可以方便的实现对程序进行权限拦截、运行监控等切面功能。</span></p><ol start='' ><li><span>声明式事务的支持</span></li></ol><p><span>支持通过配置就来完成对事务的管理，而不需要通过硬编码的方式，以前重复的一些事务提交、回滚的 JDBC 代码，都可以不用自己写了。</span></p><ol start='' ><li><span>快捷测试的支持</span></li></ol><p><span>Spring 对 Junit 提供支持，可以通过</span><strong><span>注解</span></strong><span>快捷地测试 Spring 程序。</span></p><ol start='' ><li><span>快速集成功能</span></li></ol><p><span>方便集成各种优秀框架，Spring 不排斥各种优秀的开源框架，其内部提供了对各种优秀框架（如：Struts、Hibernate、MyBatis、Quartz 等）的直接支持。</span></p><ol start='' ><li><span>复杂 API 模板封装</span></li></ol><p><span>Spring 对 JavaEE 开发中非常难用的一些 API（JDBC、JavaMail、远程调用等）都提供了模板化的封装，这些封装 API 的提供使得应用难度大大降低。</span></p><h3 id='13-spring有哪些模块'><span>1.3 Spring有哪些模块?</span></h3><p><img src="Spring面试八股文（20230701）.assets/spring-bb7c13ea-3174-4b32-84b8-821849ddc377.png" referrerpolicy="no-referrer" alt="Spring模块划分"></p><p><span>最主要的七大模块：</span></p><ol start='' ><li><strong><span>Spring Core</span></strong><span>：Spring 核心，它是框架最基础的部分，提供 IOC 和依赖注入 DI 特性。</span></li><li><strong><span>Spring Context</span></strong><span>：Spring 上下文容器，它是 BeanFactory 功能加强的一个子接口。</span></li><li><strong><span>Spring Web</span></strong><span>：它提供 Web 应用开发的支持。</span></li><li><strong><span>Spring MVC</span></strong><span>：它针对 Web 应用中 MVC 思想的实现。</span></li><li><strong><span>Spring DAO</span></strong><span>：提供对 JDBC 抽象层，简化了 JDBC 编码，同时，编码更具有健壮性。</span></li><li><strong><span>Spring ORM</span></strong><span>：它支持用于流行的 ORM 框架的整合，比如：Spring + Hibernate、Spring + iBatis、Spring + JDO 的整合等。</span></li><li><strong><span>Spring AOP</span></strong><span>：即面向切面编程，它提供了与 AOP 联盟兼容的编程实现。</span></li></ol><p><strong><span>ORM是什么？</span></strong></p><p><span>ORM（对象关系映射）是一种编程技术，用于将对象模型和关系型数据库之间建立映射关系，从而实现对象与数据库的交互和持久化操作。</span></p><p><span>在传统的关系型数据库中，数据以表格的形式进行存储和组织，而在面向对象的编程中，数据以对象的形式进行表示和操作。ORM框架的目的就是通过自动化的方式将对象模型和数据库模型之间进行转换和映射，从而简化开发人员在对象和数据库之间的转换工作。</span></p><p><span>ORM框架通常提供了以下功能：</span></p><ol start='' ><li><span>对象关系映射：ORM框架负责将对象和数据库表之间建立映射关系，将对象的属性映射到数据库表的列，将对象的关联关系映射到数据库表的关系。</span></li><li><span>数据库操作：ORM框架提供了一组API或查询语言，用于执行数据库的增删改查操作。开发人员可以使用面向对象的方式操作数据库，而无需编写复杂的SQL语句。</span></li><li><span>数据库事务管理：ORM框架通常提供了事务管理的支持，可以自动处理数据库事务的提交、回滚等操作，确保数据的一致性和完整性。</span></li><li><span>缓存管理：ORM框架通常提供了缓存管理的功能，可以缓存对象以提高查询性能，并处理缓存与数据库的同步。</span></li></ol><p><span>常见的ORM框架包括Hibernate、MyBatis、Spring Data JPA等。这些框架提供了不同的特性和使用方式，开发人员可以根据需求选择合适的框架进行对象和数据库的映射和交互。</span></p><p><span>使用ORM框架可以简化数据库操作的代码编写，提高开发效率和代码的可维护性。同时，ORM框架也提供了一定程度的数据库平台无关性，使得应用程序更加灵活和可移植。然而，使用ORM框架也需要注意性能和配置的问题，需要根据具体的场景进行合理的选择和配置。</span></p><h3 id='14-spring常见注解'><span>1.4 Spring常见注解</span></h3><p>&nbsp;</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8d0a1518-a425-4887-9735-45321095d927.png" alt="Spring常用注解" style="zoom:80%;" /></p><p><strong><span>Web</span></strong><span>:</span></p><ul><li><p><span>@Controller：组合注解（组合了@Component 注解），应用在 MVC 层（控制层）。</span></p></li><li><p><span>@RestController：该注解为一个组合注解，相当于@Controller 和@ResponseBody 的组合，注解在类上，意味着，该 Controller 的所有方法都默认加上了@ResponseBody。</span></p></li><li><p><span>@RequestMapping：用于映射 Web 请求，包括访问路径和参数。如果是 Restful 风格接口，还可以根据请求类型使用不同的注解：</span></p><ul><li><span>@GetMapping</span></li><li><span>@PostMapping</span></li><li><span>@PutMapping</span></li><li><span>@DeleteMapping</span></li></ul></li><li><p><span>@ResponseBody：支持将返回值放在 response 内，而不是一个页面，通常用户返回 json 数据。</span></p></li><li><p><span>@RequestBody：允许 request 的参数在 request 体中，而不是在直接连接在地址后面。</span></p></li><li><p><span>@PathVariable：用于接收路径参数，比如 </span><code>@RequestMapping(“/hello/{name}”)</code><span>申明的路径，将注解放在参数中前，即可获取该值，通常作为 Restful 的接口实现方法。</span></p></li><li><p><span>@RestController：该注解为一个组合注解，相当于@Controller 和@ResponseBody 的组合，注解在类上，意味着，该 Controller 的所有方法都默认加上了@ResponseBody。</span></p></li></ul><p><strong><span>容器</span></strong><span>:</span></p><ul><li><span>@Component：表示一个带注释的类是一个“组件”，成为 Spring 管理的 Bean。当使用基于注解的配置和类路径扫描时，这些类被视为自动检测的候选对象。同时@Component 还是一个元注解。</span></li><li><span>@Service：组合注解（组合了@Component 注解），应用在 service 层（业务逻辑层）。</span></li><li><span>@Repository：组合注解（组合了@Component 注解），应用在 dao 层（数据访问层）。</span></li><li><span>@Autowired：Spring 提供的工具（由 Spring 的依赖注入工具（BeanPostProcessor、BeanFactoryPostProcessor）自动注入）。</span></li><li><span>@Qualifier：该注解通常跟 @Autowired 一起使用，当想对注入的过程做更多的控制，@Qualifier 可帮助配置，比如两个以上相同类型的 Bean 时 Spring 无法抉择，用到此注解</span></li><li><span>@Configuration：声明当前类是一个配置类（相当于一个 Spring 配置的 xml 文件）</span></li><li><span>@Value：可用在字段，构造器参数跟方法参数，指定一个默认值，支持 </span><code>#{} 跟 \${}</code><span> 两个方式。一般将 SpringbBoot 中的 application.properties 配置的属性值赋值给变量。</span></li><li><span>@Bean：注解在方法上，声明当前方法的返回值为一个 Bean。返回的 Bean 对应的类中可以定义 init()方法和 destroy()方法，然后在</span><code>@Bean(initMethod=”init”,destroyMethod=”destroy”)</code><span>定义，在构造之后执行 init，在销毁之前执行 destroy。</span></li><li><span>@Scope:定义我们采用什么模式去创建 Bean（方法上，得有@Bean） 其设置类型包括：Singleton 、Prototype、Request 、 Session、GlobalSession。</span></li></ul><p><strong><span>AOP</span></strong><span>:</span></p><ul><li><p><span>@Aspect:声明一个切面（类上） 使用@After、@Before、@Around 定义建言（advice），可直接将拦截规则（切点）作为参数。</span></p><ul><li><code>@After</code><span> ：在方法执行之后执行（方法上）。</span></li><li><code>@Before</code><span>： 在方法执行之前执行（方法上）。</span></li><li><code>@Around</code><span>： 在方法执行之前与之后执行（方法上）。</span></li><li><code>@PointCut</code><span>： 声明切点 在 java 配置类中使用@EnableAspectJAutoProxy 注解开启 Spring 对 AspectJ 代理的支持（类上）。</span></li></ul></li></ul><p><strong><span>事务：</span></strong></p><ul><li><span>@Transactional：在要开启事务的方法上使用@Transactional 注解，即可声明式开启事务。</span></li></ul><h3 id='15-spring中应用了哪些设计模式'><span>1.5 Spring中应用了哪些设计模式？</span></h3><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-ee1c5cee-8462-4bae-93ea-ec936cc77640.png" alt="Spring中用到的设计模式" style="zoom:80%;" /></p><ol start='' ><li><strong><span>工厂模式</span></strong><span> : Spring 容器本质是一个大工厂，使用工厂模式通过 BeanFactory、ApplicationContext 创建 bean 对象。</span></li><li><strong><span>代理模式</span></strong><span> : Spring AOP 功能功能就是通过代理模式来实现的，分为动态代理和静态代理。</span></li><li><strong><span>单例模式</span></strong><span> : Spring 中的 Bean 默认都是单例的，这样有利于容器对 Bean 的管理。</span></li><li><strong><span>模板模式</span></strong><span> : Spring 中 JdbcTemplate、RestTemplate 等以 Template 结尾的对数据库、网络等等进行操作的模板类，就使用到了模板模式。</span></li><li><strong><span>观察者模式</span></strong><span>: Spring 事件驱动模型就是观察者模式很经典的一个应用。</span></li><li><strong><span>适配器模式</span></strong><span> :Spring AOP 的增强或通知 (Advice) 使用到了适配器模式、Spring MVC 中也是用到了适配器模式适配 Controller。</span></li><li><strong><span>策略模式</span></strong><span>：Spring 中有一个 Resource 接口，它的不同实现类，会根据不同的策略去访问资源。</span></li></ol><h3 id='16-什么是ioc什么是di'><span>1.6 什么是IOC？什么是DI？</span></h3><p><span>Java 是面向对象的编程语言，一个个实例对象相互合作组成了业务逻辑，原来，我们都是在代码里创建对象和对象的依赖。</span></p><p><span>所谓的</span><strong><span>IOC</span></strong><span>（控制反转）：就是由容器来负责控制对象的生命周期和对象间的关系。以前是我们想要什么，就自己创建什么，现在是我们需要什么，容器就给我们送来什么。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-619da277-c15e-4dd7-9f2b-dbd809a9aaa0.png" referrerpolicy="no-referrer" alt="引入IOC之前和引入IOC之后"><span>																				</span><span>引入IOC之前和引入IOC之后</span></p><p><span>也就是说，控制对象生命周期的不再是引用它的对象，而是容器。对具体对象，以前是它控制其它对象，现在所有对象都被容器控制，所以这就叫</span><strong><span>控制反转</span></strong><span>。（把控制的权力交给容器）</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-440f5d0e-f4db-462c-97fb-d54407a354d5.png" referrerpolicy="no-referrer" alt="控制反转示意图"></p><p><span>																								</span><span>控制反转示意图</span></p><p><strong><span>DI（依赖注入）</span></strong><span>：指的是容器在实例化对象的时候把它依赖的类注入给它。有的说法 IOC 和 DI 是一回事，有的说法是 IOC 是思想，DI 是 IOC 的实现。</span></p><blockquote><p><strong><span>为什么要使用 IOC 呢？</span></strong></p></blockquote><p><span>最主要的是两个字</span><strong><span>解耦</span></strong><span>，硬编码会造成对象间的过度耦合，使用 IOC 之后，我们可以不用关心对象间的依赖，专心开发应用就行。</span></p><h3 id='17-spring-ioc的实现机制'><span>1.7 Spring IOC的实现机制</span></h3><p><strong><span>什么是Spring IOC?</span></strong></p><p><span>Spring的IOC（Inversion of Control，控制反转）是一种设计原则和编程模式，用于实现松耦合和可维护的应用程序。IOC的核心思想是将对象的创建和依赖关系的管理交给容器来完成，而不是由应用程序代码直接管理。</span></p><p><span>在Spring框架中，IOC通过容器（如ApplicationContext）来管理对象的生命周期和依赖注入。它将对象的创建、配置和装配都交给容器来处理，应用程序只需要定义对象和它们之间的关系，而不需要关注对象的实例化和依赖的解析。</span></p><p><span>IOC的主要优点包括：</span></p><ol start='' ><li><span>松耦合：IOC将对象之间的依赖关系从代码中解耦，使得对象之间的耦合度降低，提高了代码的可维护性和可测试性。</span></li><li><span>可扩展性：通过IOC容器管理对象的创建和配置，可以方便地添加、修改或替换对象，实现应用程序的灵活扩展。</span></li><li><span>配置集中化：IOC通过配置文件（如XML、注解、Java Config等）来描述对象和依赖关系，使得配置集中化、易于管理和修改。</span></li><li><span>面向接口编程：IOC鼓励面向接口编程，通过接口和抽象类定义对象的行为和依赖关系，增强了代码的可扩展性和可重用性。</span></li></ol><p><span>在Spring框架中，IOC主要通过依赖注入（Dependency Injection，DI）来实现。依赖注入是指容器负责将对象的依赖关系注入到对象中，而不是由对象自己去获取依赖。Spring框架提供了多种依赖注入的方式，包括构造函数注入、Setter方法注入和字段注入等。</span></p><p><span>通过使用IOC和依赖注入，开发人员可以将关注点从对象的创建和依赖解析转移到业务逻辑的实现上，提高了代码的可维护性、可测试性和可扩展性。</span></p><p><span>PS:这道题老三在面试中被问到过，问法是“</span><strong><span>你有自己实现过简单的 Spring 吗？</span></strong><span>”</span></p><p><span>Spring 的 IOC 本质就是一个大工厂，我们想想一个工厂是怎么运行的呢？</span></p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-7678c40f-a48d-4bd5-80f8-e902ad688e11.png"/></p><ul><li><p><strong><span>生产产品</span></strong><span>：一个工厂最核心的功能就是生产产品。在 Spring 里，不用 Bean 自己来实例化，而是交给 Spring，应该怎么实现呢？——答案毫无疑问，</span><strong><span>反射</span></strong><span>。</span></p><p><span>那么这个厂子的生产管理是怎么做的？你应该也知道——</span><strong><span>工厂模式</span></strong><span>。</span></p></li><li><p><strong><span>库存产品</span></strong><span>：工厂一般都是有库房的，用来库存产品，毕竟生产的产品不能立马就拉走。Spring 我们都知道是一个容器，这个容器里存的就是对象，不能每次来取对象，都得现场来反射创建对象，得把创建出的对象存起来。</span></p></li><li><p><strong><span>订单处理</span></strong><span>：还有最重要的一点，工厂根据什么来提供产品呢？订单。这些订单可能五花八门，有线上签签的、有到工厂签的、还有工厂销售上门签的……最后经过处理，指导工厂的出货。</span></p><p><strong><span>在 Spring 里，也有这样的订单，它就是我们 bean 的定义和依赖关系，可以是 xml 形式，也可以是我们最熟悉的注解形式。</span></strong></p></li></ul><p><span>我们简单地实现一个 mini 版的 Spring IOC：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-1d55c63d-2d12-43b1-9f43-428f5f4a1413.png" referrerpolicy="no-referrer" alt="mini版本Spring IOC"></p><h4 id='171-写个mini版本的spring-ioc'><span>1.7.1 写个mini版本的Spring IOC</span></h4><p><strong><span>Bean 定义：</span></strong></p><p><span>Bean 通过一个配置文件定义，把它解析成一个类型。</span></p><ul><li><p><span>beans.properties</span></p><p><span>偷懒，这里直接用了最方便解析的 properties，这里直接用一个</span><code>&lt;key,value&gt;</code><span>类型的配置来代表 Bean 的定义，其中 key 是 beanName，value 是 class</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">userDao</span>:<span class="cm-variable">cn</span>.<span class="cm-variable">fighter3</span>.<span class="cm-variable">bean</span>.<span class="cm-variable">UserDao</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre></li><li><p><span>BeanDefinition.java</span></p><p><span>bean 定义类，配置文件中 bean 定义对应的实体</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">BeanDefinition</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">Class</span> <span class="cm-variable">beanClass</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">//省略getter、setter</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 183px;"></div><div class="CodeMirror-gutters" style="display: none; height: 183px;"></div></div></div></pre></li><li><p><span>ResourceLoader.java</span></p><p><span>资源加载器，用来完成配置文件中配置的加载</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ResourceLoader</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">getResource</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanDefinitionMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-number">16</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Properties</span> <span class="cm-variable">properties</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Properties</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">InputStream</span> <span class="cm-variable">inputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">ResourceLoader</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">getResourceAsStream</span>(<span class="cm-string">"/beans.properties"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">properties</span>.<span class="cm-variable">load</span>(<span class="cm-variable">inputStream</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Iterator</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">it</span> <span class="cm-operator">=</span> <span class="cm-variable">properties</span>.<span class="cm-variable">stringPropertyNames</span>().<span class="cm-variable">iterator</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">it</span>.<span class="cm-variable">hasNext</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">key</span> <span class="cm-operator">=</span> <span class="cm-variable">it</span>.<span class="cm-variable">next</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">className</span> <span class="cm-operator">=</span> <span class="cm-variable">properties</span>.<span class="cm-variable">getProperty</span>(<span class="cm-variable">key</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">beanDefinition</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanDefinition</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">setBeanName</span>(<span class="cm-variable">key</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Class</span> <span class="cm-variable">clazz</span> <span class="cm-operator">=</span> <span class="cm-variable">Class</span>.<span class="cm-variable">forName</span>(<span class="cm-variable">className</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">setBeanClass</span>(<span class="cm-variable">clazz</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanDefinitionMap</span>.<span class="cm-variable">put</span>(<span class="cm-variable">key</span>, <span class="cm-variable">beanDefinition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inputStream</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">IOException</span> <span class="cm-operator">|</span> <span class="cm-variable">ClassNotFoundException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">beanDefinitionMap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 680px;"></div><div class="CodeMirror-gutters" style="display: none; height: 680px;"></div></div></div></pre><p><strong><span>上面代码中的Class.forName()是什么？</span></strong></p><p><code>Class.forName()</code><span>是Java中用于加载类的方法之一。它是Java反射机制的一部分，用于动态加载类并在运行时获取类的相关信息。</span></p><p><code>Class.forName()</code><span>方法的作用是根据类的全限定名</span><strong><span>（包括包名和类名）</span></strong><span>来加载类并返回对应的</span><code>Class</code><span>对象。它可以加载类的字节码文件，并将其转换为</span><code>Class</code><span>对象，以便在运行时进行操作。</span></p><p><span>使用</span><code>Class.forName()</code><span>方法可以实现动态加载类，不需要在编译时确定类的具体名称，而是在运行时根据条件决定加载哪个类。</span></p><p><span>下面是</span><code>Class.forName()</code><span>方法的基本用法：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">try</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">clazz</span> <span class="cm-operator">=</span> <span class="cm-variable">Class</span>.<span class="cm-variable">forName</span>(<span class="cm-string">"com.example.MyClass"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 对获取到的Class对象进行操作，如创建实例、调用方法等</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">catch</span> (<span class="cm-variable">ClassNotFoundException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 类未找到异常处理逻辑</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>在上述代码中，通过</span><code>Class.forName(&quot;com.example.MyClass&quot;)</code><span>加载名为</span><code>com.example.MyClass</code><span>的类，并将其对应的</span><code>Class</code><span>对象赋值给</span><code>clazz</code><span>变量。接下来，可以通过</span><code>clazz</code><span>变量进行相应的操作，如创建实例、调用方法等。</span></p><p><span>需要注意的是，</span><code>Class.forName()</code><span>方法在加载类时会执行该类的静态代码块，因此可以用于初始化静态资源。同时，该方法还可以接受一个额外的参数，用于指定是否执行静态初始化块，默认为</span><code>true</code><span>。例如：</span><code>Class.forName(&quot;com.example.MyClass&quot;, true)</code><span>。</span></p><p><span>另外，从Java 9 开始，推荐使用</span><code>Class.forName()</code><span>的替代方法</span><code>Class.forName(&quot;com.example.MyClass&quot;).newInstance()</code><span>来创建实例。这样可以避免直接使用</span><code>newInstance()</code><span>方法，因为</span><code>newInstance()</code><span>方法在Java 9 中已被标记为过时方法。</span></p></li><li><p><span>BeanRegister.java</span></p><p><span>对象注册器，这里用于单例 bean 的缓存，我们大幅简化，默认所有 bean 都是单例的。可以看到所谓单例注册，也很简单，不过是往 HashMap 里存对象。</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">BeanRegister</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//单例Bean缓存</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">Object</span><span class="cm-operator">&gt;</span> <span class="cm-variable">singletonMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-number">32</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 获取单例Bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @param beanName bean名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @return</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">getSingletonBean</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">singletonMap</span>.<span class="cm-variable">get</span>(<span class="cm-variable">beanName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 注册单例bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @param beanName</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @param bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">registerSingletonBean</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">singletonMap</span>.<span class="cm-variable">containsKey</span>(<span class="cm-variable">beanName</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">singletonMap</span>.<span class="cm-variable">put</span>(<span class="cm-variable">beanName</span>, <span class="cm-variable">bean</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 758px;"></div><div class="CodeMirror-gutters" style="display: none; height: 758px;"></div></div></div></pre></li><li><p><strong><span>BeanFactory.java</span></strong></p></li></ul><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-c6b3b707-cf53-4c7c-a6f9-8560950806fc.png" referrerpolicy="no-referrer" alt="BeanFactory"></p><p><span>                                                              </span><span>									</span><span>BeanFactory</span></p><ul><li><p><span>对象工厂，我们最</span><strong><span>核心</span></strong><span>的一个类，在它初始化的时候，创建了 bean 注册器，完成了资源的加载。</span></p></li><li><p><span>获取 bean 的时候，先从单例缓存中取，如果没有取到，就创建并注册一个 bean</span></p><p>&nbsp;</p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">BeanFactory</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanDefinitionMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">HashMap</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">BeanRegister</span> <span class="cm-variable">beanRegister</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">BeanFactory</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//创建bean注册器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanRegister</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanRegister</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//加载资源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">beanDefinitionMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ResourceLoader</span>().<span class="cm-variable">getResource</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 获取bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @param beanName bean名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @return</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">getBean</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">beanName</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//从bean缓存中取</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span> <span class="cm-operator">=</span> <span class="cm-variable">beanRegister</span>.<span class="cm-variable">getSingletonBean</span>(<span class="cm-variable">beanName</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">bean</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">bean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//根据bean定义，创建bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">createBean</span>(<span class="cm-variable">beanDefinitionMap</span>.<span class="cm-variable">get</span>(<span class="cm-variable">beanName</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 创建Bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @param beanDefinition bean定义</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* @return</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">createBean</span>(<span class="cm-variable">BeanDefinition</span> <span class="cm-variable">beanDefinition</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">bean</span> <span class="cm-operator">=</span> <span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getBeanClass</span>().<span class="cm-variable">newInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//缓存bean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">beanRegister</span>.<span class="cm-variable">registerSingletonBean</span>(<span class="cm-variable">beanDefinition</span>.<span class="cm-variable">getBeanName</span>(), <span class="cm-variable">bean</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">bean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InstantiationException</span> <span class="cm-operator">|</span> <span class="cm-variable">IllegalAccessException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1229px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1229px;"></div></div></div></pre></li><li><p><span>测试</span></p><ul><li><p><span>UserDao.java</span></p><p><span>我们的 Bean 类，很简单</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">UserDao</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">queryUserInfo</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A good man."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre></li><li><p><span>单元测试</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ApiTest</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Test</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">test_BeanFactory</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//1.创建bean工厂(同时完成了加载资源、创建注册单例bean注册器的操作)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BeanFactory</span> <span class="cm-variable">beanFactory</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BeanFactory</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//2.第一次获取bean（通过反射创建bean，缓存bean）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UserDao</span> <span class="cm-variable">userDao1</span> <span class="cm-operator">=</span> (<span class="cm-variable">UserDao</span>) <span class="cm-variable">beanFactory</span>.<span class="cm-variable">getBean</span>(<span class="cm-string">"userDao"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">userDao1</span>.<span class="cm-variable">queryUserInfo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//3.第二次获取bean（从缓存中获取bean）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UserDao</span> <span class="cm-variable">userDao2</span> <span class="cm-operator">=</span> (<span class="cm-variable">UserDao</span>) <span class="cm-variable">beanFactory</span>.<span class="cm-variable">getBean</span>(<span class="cm-string">"userDao"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">userDao2</span>.<span class="cm-variable">queryUserInfo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 392px;"></div><div class="CodeMirror-gutters" style="display: none; height: 392px;"></div></div></div></pre></li><li><p><span>运行结果</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A</span> <span class="cm-variable">good</span> <span class="cm-variable">man</span>.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A</span> <span class="cm-variable">good</span> <span class="cm-variable">man</span>.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre></li></ul></li></ul><p><span>至此，我们一个乞丐+破船版的 Spring 就完成了，代码也比较完整，有条件的可以跑一下。</span></p><p><span>PS:因为时间+篇幅的限制，这个 demo 比较简陋，没有面向接口、没有解耦、边界检查、异常处理……健壮性、扩展性都有很大的不足。</span></p><h4 id='172-拓展'><span>1.7.2 拓展</span></h4><p><strong><span>反射是什么？</span></strong></p><p><span>反射（Reflection）是指在运行时动态地获取和操作类的信息以及调用类的方法和访问类的属性的能力。Java反射机制提供了一组API，使得我们可以在程序运行时获取类的信息，如类的构造方法、字段、方法等，并可以在运行时动态地创建对象、调用方法和访问属性，而无需在编译时确定类的具体信息。</span></p><p><span>Java反射机制的核心是</span><code>java.lang.reflect</code><span>包中的</span><code>Class</code><span>类及其相关类和接口。通过</span><code>Class</code><span>类，我们可以获取类的各种信息，包括类名、包名、父类、实现的接口、字段、方法、构造方法等。</span></p><p><span>使用Java反射，我们可以做到以下一些操作：</span></p><ol start='' ><li><span>动态地创建对象：通过反射，可以在</span><strong><span>运行时根据类名动态地创建对象，而无需提前知道类的具体名称</span></strong><span>。</span></li><li><span>调用方法：可以通过反射调用类的方法，包括公共方法和私有方法，可以在运行时动态地选择要调用的方法。</span></li><li><span>访问属性：可以通过反射访问类的字段，包括公共字段和私有字段，可以获取字段的值或修改字段的值。</span></li><li><span>获取类的信息：可以获取类的各种信息，如类名、包名、父类、实现的接口、字段、方法、构造方法等。</span></li></ol><p><span>反射机制在某些特定的场景下非常有用，例如：</span></p><ul><li><span>框架和库：许多框架和库使用反射机制实现动态扩展和配置，如Spring框架、Hibernate框架等。</span></li><li><span>序列化和反序列化：在对象的序列化和反序列化过程中，反射机制用于读取和写入对象的字段。</span></li><li><span>动态代理：通过反射机制可以在运行时动态生成代理对象，实现AOP（面向切面编程）等功能。</span></li></ul><p><span>需要注意的是，尽管反射机制提供了很大的灵活性和动态性，但过度使用反射可能会降低性能和安全性。因此，在使用反射时需要谨慎，并根据实际需求权衡使用的利弊。</span></p><p><strong><span>工厂模式是什么？</span></strong></p><p><span>工厂模式（Factory Pattern）是一种创建型设计模式，旨在提供一种统一的接口来创建对象，而无需在代码中直接指定具体的类。它将对象的实例化过程封装在一个工厂类中，客户端只需要通过调用工厂类的方法来创建对象，而不需要关心具体的实现细节。</span></p><p><span>工厂模式主要包括以下几个角色：</span></p><ol start='' ><li><span>抽象产品（Abstract Product）：定义了产品的通用接口，具体产品类要实现这个接口。</span></li><li><span>具体产品（Concrete Product）：实现了抽象产品接口的具体产品类。</span></li><li><span>抽象工厂（Abstract Factory）：定义了创建产品的抽象方法，通常是一个接口或抽象类。</span></li><li><span>具体工厂（Concrete Factory）：实现了抽象工厂定义的创建产品的方法，返回具体产品的实例。</span></li></ol><p><span>工厂模式的主要目的是将对象的创建和使用解耦，使得系统更具灵活性和可扩展性。客户端只需关心工厂提供的接口，而不需要直接实例化具体的产品类。这样，如果需要修改或添加新的产品，只需修改或扩展工厂类，而不需要修改客户端代码。</span></p><p><span>工厂模式可以分为三种常见的形式：</span></p><ol start='' ><li><span>简单工厂模式（Simple Factory Pattern）：通过一个工厂类来创建所有的产品对象，客户端只需要传递参数给工厂类，由工厂类来决定创建哪个具体产品对象。</span></li><li><span>工厂方法模式（Factory Method Pattern）：定义一个抽象工厂类，由具体的工厂子类来创建具体的产品对象。每个具体的工厂子类负责创建一个具体的产品。</span></li><li><span>抽象工厂模式（Abstract Factory Pattern）：提供一个抽象工厂接口，定义了一组用于创建一系列相关或依赖对象的方法，每个具体的工厂类负责创建一族产品。</span></li></ol><p><span>工厂模式在实际的软件开发中经常被使用，它能够提供灵活、可扩展的对象创建方式，并帮助降低代码的耦合度。</span></p><p><strong><span>简单工厂模式代码：</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 抽象产品</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-def">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体产品 A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteProductA</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"具体产品 A 的操作"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体产品 B</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteProductB</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"具体产品 B 的操作"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 简单工厂类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">SimpleFactory</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">Product</span> <span class="cm-variable">createProduct</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">type</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">type</span>.<span class="cm-variable">equalsIgnoreCase</span>(<span class="cm-string">"A"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteProductA</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">type</span>.<span class="cm-variable">equalsIgnoreCase</span>(<span class="cm-string">"B"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteProductB</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 客户端代码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Client</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Product</span> <span class="cm-variable">productA</span> <span class="cm-operator">=</span> <span class="cm-variable">SimpleFactory</span>.<span class="cm-variable">createProduct</span>(<span class="cm-string">"A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">productA</span>.<span class="cm-variable">operation</span>(); <span class="cm-comment">// 输出：具体产品 A 的操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Product</span> <span class="cm-variable">productB</span> <span class="cm-operator">=</span> <span class="cm-variable">SimpleFactory</span>.<span class="cm-variable">createProduct</span>(<span class="cm-string">"B"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">productB</span>.<span class="cm-variable">operation</span>(); <span class="cm-comment">// 输出：具体产品 B 的操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1150px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1150px;"></div></div></div></pre><p><span>在上述代码中，定义了一个抽象产品接口 </span><code>Product</code><span>，以及两个具体产品类 </span><code>ConcreteProductA</code><span> 和 </span><code>ConcreteProductB</code><span>，它们实现了抽象产品接口。</span></p><p><span>然后，定义了一个简单工厂类 </span><code>SimpleFactory</code><span>，其中的 </span><code>createProduct</code><span> 方法根据传入的参数类型，决定创建具体的产品对象并返回。</span></p><p><span>最后，在客户端代码中，通过调用 </span><code>SimpleFactory.createProduct</code><span> 方法来创建产品对象，无需关心具体的产品类是如何创建的。根据传入的参数不同，可以创建不同的具体产品，并调用其操作方法。</span></p><p><span>简单工厂模式将产品的创建过程封装在工厂类中，客户端只需要和工厂类进行交互，而不需要直接依赖具体的产品类。这样可以降低客户端和具体产品类之间的耦合度，提高系统的灵活性和可扩展性。</span></p><p><strong><span>工厂方法模式代码</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 抽象产品</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-def">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体产品 A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteProductA</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"具体产品 A 的操作"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体产品 B</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteProductB</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Product</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">operation</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"具体产品 B 的操作"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 抽象工厂</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">interface</span> <span class="cm-def">Factory</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Product</span> <span class="cm-variable">createProduct</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体工厂 A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteFactoryA</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Factory</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Product</span> <span class="cm-variable">createProduct</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteProductA</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 具体工厂 B</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ConcreteFactoryB</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Factory</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Product</span> <span class="cm-variable">createProduct</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteProductB</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 客户端代码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Client</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Factory</span> <span class="cm-variable">factoryA</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteFactoryA</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Product</span> <span class="cm-variable">productA</span> <span class="cm-operator">=</span> <span class="cm-variable">factoryA</span>.<span class="cm-variable">createProduct</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">productA</span>.<span class="cm-variable">operation</span>(); <span class="cm-comment">// 输出：具体产品 A 的操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Factory</span> <span class="cm-variable">factoryB</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcreteFactoryB</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Product</span> <span class="cm-variable">productB</span> <span class="cm-operator">=</span> <span class="cm-variable">factoryB</span>.<span class="cm-variable">createProduct</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">productB</span>.<span class="cm-variable">operation</span>(); <span class="cm-comment">// 输出：具体产品 B 的操作</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1438px;"></div></div></div></pre><p><span>在上述代码中，定义了一个抽象产品接口 </span><code>Product</code><span>，以及两个具体产品类 </span><code>ConcreteProductA</code><span> 和 </span><code>ConcreteProductB</code><span>，它们实现了抽象产品接口。</span></p><p><span>然后，定义了一个抽象工厂接口 </span><code>Factory</code><span>，其中的 </span><code>createProduct</code><span> 方法用于创建产品对象。</span></p><p><span>接着，定义了两个具体工厂类 </span><code>ConcreteFactoryA</code><span> 和 </span><code>ConcreteFactoryB</code><span>，它们分别实现了抽象工厂接口，并实现了对应的 </span><code>createProduct</code><span> 方法，用于创建具体的产品对象。</span></p><p><span>最后，在客户端代码中，通过实例化具体的工厂对象，然后调用 </span><code>createProduct</code><span> 方法来创建产品对象，并调用其操作方法。</span></p><p><span>工厂方法模式通过将产品的创建过程委托给具体的工厂类，实现了客户端和具体产品的解耦。客户端只需要与抽象工厂接口进行交互，无需关心具体的产品类和工厂类的实现细节。这样可以实现更灵活的对象创建方式，支持扩展新的产品类和工厂类。</span></p><p><strong><span>抽象工厂方法见</span></strong><span>：</span><a href='https://www.runoob.com/design-pattern/abstract-factory-pattern.html' target='_blank' class='url'>https://www.runoob.com/design-pattern/abstract-factory-pattern.html</a></p><h3 id='18-什么是beanfactory和applicationcontext'><span>1.8 什么是BeanFactory和ApplicationContext?</span></h3><p><span>BeanFactory和ApplicationContext是Spring框架中的两个关键接口，用于管理和获取Bean对象。它们在Spring中扮演不同的角色。</span></p><ol start='' ><li><p><span>BeanFactory（Bean工厂）：</span></p><ul><li><span>BeanFactory是Spring框架的基础接口，提供了最基本的IoC容器功能。它是Spring的核心容器，负责管理Bean对象的创建、配置和生命周期管理。</span></li><li><span>BeanFactory采用延迟初始化机制，即在首次访问Bean时才会创建和初始化Bean对象。</span></li><li><span>BeanFactory提供了基本的Bean管理功能，如获取Bean、销毁Bean等，但对于更高级的特性，如AOP、事务管理等，需要使用ApplicationContext。</span></li></ul></li><li><p><span>ApplicationContext（应用上下文）：</span></p><ul><li><span>ApplicationContext是BeanFactory的子接口，它继承了BeanFactory的功能，并提供了更多的企业级特性和扩展功能。</span></li><li><span>ApplicationContext在初始化时就会预先实例化和配置所有的单例Bean，而不是在首次访问时才创建。这样可以提前发现Bean的配置错误，并提高应用程序的性能。</span></li><li><span>ApplicationContext支持国际化、事件发布、资源加载、AOP、事务管理等高级特性，并且可以与Spring的其他功能集成，如Spring MVC、Spring Security等。</span></li><li><span>ApplicationContext是使用最广泛的Spring容器接口，通常在实际开发中推荐使用ApplicationContext来管理Bean对象。</span></li></ul></li></ol><p><span>总结：</span>
<span>BeanFactory是Spring的基础容器接口，提供了基本的Bean管理功能，采用延迟初始化机制；而ApplicationContext是BeanFactory的子接口，提供了更多的企业级特性和扩展功能，采用预先实例化和配置所有的单例Bean的方式。在实际开发中，ApplicationContext是首选的Spring容器接口，它提供了更全面和强大的功能。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-6e6d4b69-f36c-41e6-b8ba-9277be147c9b.png" referrerpolicy="no-referrer" alt="Spring5 BeanFactory继承体系"></p><p><span>																		</span><span>BeanFactory和ApplicantContext的比喻</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-e201c9a3-f23c-4768-b844-ac7e0ba4bcec.png" referrerpolicy="no-referrer" alt="Spring5 ApplicationContext部分体系类图"></p><p><span>																		</span><span>Spring5 ApplicationContext部分体系类图</span></p><h3 id='19-spring-容器启动阶段会干什么'><span>1.9 Spring 容器启动阶段会干什么？</span></h3><p><span>PS：这道题老三面试被问到过</span></p><p><span>Spring 的 IOC 容器工作的过程，其实可以划分为两个阶段：</span><strong><span>容器启动阶段</span></strong><span>和</span><strong><span>Bean 实例化阶段</span></strong><span>。</span></p><p><span>其中容器启动阶段主要做的工作是加载和解析配置文件，保存到对应的 Bean 定义中。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-8f8103f7-2a51-4858-856e-96a4ac400d76.png" referrerpolicy="no-referrer" alt="容器启动和Bean实例化阶段"></p><p><span>																				</span><span>容器启动和Bean实例化阶段</span></p><p><span>容器启动开始，首先会通过某种途径加载 Configuration MetaData，在大部分情况下，容器需要依赖某些工具类（BeanDefinitionReader）对加载的 Configuration MetaData 进行解析和分析，并将分析后的信息组为相应的 BeanDefinition。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-dfb3d8c4-ba8d-4a2c-aef2-4ad425f7180c.png" referrerpolicy="no-referrer" alt="xml配置信息映射注册过程"></p><p><span>最后把这些保存了 Bean 定义必要信息的 BeanDefinition，注册到相应的 BeanDefinitionRegistry，这样容器启动就完成了。</span></p><p><strong><span>总结：</span></strong></p><p><span>在Spring容器启动阶段，会执行以下主要任务：</span></p><ol start='' ><li><span>加载配置文件：Spring容器会读取配置文件（如XML配置文件、注解等）来了解如何创建和组织Bean对象。这些配置文件包含了Bean的定义、依赖关系以及其他配置信息。</span></li><li><span>创建Bean实例：根据配置文件中的定义，Spring容器会实例化和创建Bean对象。它会根据配置中的信息，调用合适的构造函数或工厂方法来创建Bean的实例。</span></li><li><span>处理Bean的依赖关系：Spring容器会解析Bean之间的依赖关系，确保每个Bean都能够获取它所依赖的其他Bean。它会查找并注入依赖的Bean对象。</span></li><li><span>应用Bean的属性：Spring容器会将配置文件中指定的属性值设置到相应的Bean对象中。这可以通过setter方法、字段注入等方式完成。</span></li><li><span>执行初始化方法：如果Bean实现了InitializingBean接口或在配置文件中定义了初始化方法，Spring容器会在Bean创建完成后调用相应的初始化方法。</span></li><li><span>注册Bean的销毁回调：如果Bean实现了DisposableBean接口或在配置文件中定义了销毁方法，Spring容器会在容器关闭时调用相应的销毁方法，释放资源。</span></li><li><span>提供Bean实例：完成以上步骤后，Spring容器会将创建和初始化完成的Bean对象保存在容器中，并可以通过Bean的名称或类型进行获取和使用。</span></li><li><span>触发事件：在容器启动阶段，Spring容器还可以触发一些事件，通知相关的监听器。这些事件可以是容器初始化完成、Bean初始化完成等事件。</span></li></ol><p><span>总之，Spring容器启动阶段的主要任务是读取配置文件、创建Bean实例、处理Bean的依赖关系、应用Bean的属性、执行初始化方法和注册销毁回调。这些任务确保了Bean的正确创建和配置，并为后续的业务逻辑提供了准备条件。</span></p><h3 id='110-spring-bean的生命周期'><span>1.10 Spring Bean的生命周期</span></h3><p><span>在 Spring 中，基本容器 BeanFactory 和扩展容器 ApplicationContext 的实例化时机不太一样，BeanFactory 采用的是延迟初始化的方式，也就是只有在第一次 getBean()的时候，才会实例化 Bean；ApplicationContext 启动之后会实例化所有的 Bean 定义。</span></p><p><span>Spring IOC 中 Bean 的生命周期大致分为四个阶段：</span><strong><span>实例化</span></strong><span>（Instantiation）、</span><strong><span>属性赋值</span></strong><span>（Populate）、</span><strong><span>初始化</span></strong><span>（Initialization）、</span><strong><span>销毁</span></strong><span>（Destruction）。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-595fce5b-36cb-4dcb-b08c-8205a1e98d8a.png" referrerpolicy="no-referrer" alt="Bean生命周期四个阶段"></p><p><span>																					</span><span>Bean生命周期四个阶段</span></p><p><span>我们再来看一个稍微详细一些的过程：</span></p><ul><li><strong><span>实例化</span></strong><span>：第 1 步，实例化一个 Bean 对象</span></li><li><strong><span>属性赋值</span></strong><span>：第 2 步，为 Bean 设置相关属性和依赖</span></li><li><strong><span>初始化</span></strong><span>：初始化的阶段的步骤比较多，5、6 步是真正的初始化，第 3、4 步为在初始化前执行，第 7 步在初始化后执行，初始化完成之后，Bean 就可以被使用了</span></li><li><strong><span>销毁</span></strong><span>：第 8~10 步，第 8 步其实也可以算到销毁阶段，但不是真正意义上的销毁，而是先在使用前注册了销毁的相关调用接口，为了后面第 9、10 步真正销毁 Bean 时再执行相应的方法</span></li></ul><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png" referrerpolicy="no-referrer" alt="SpringBean生命周期"></p><p><span>简单总结一下，Bean 生命周期里初始化的过程相对步骤会多一些，比如前置、后置的处理。</span></p><p><span>最后通过一个实例来看一下具体的细节：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-a3b7714e-38f2-433d-97c6-acb1d20f2887.png" referrerpolicy="no-referrer" alt="Bean生命周期源码追踪"></p><p><span>关于源码，Bean 创建过程可以查看</span><code>AbstractBeanFactory#doGetBean</code><span>方法，在这个方法里可以看到 Bean 的实例化，赋值、初始化的过程，至于最终的销毁，可以看看</span><code>ConfigurableApplicationContext#close()</code><span>。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-d2da20a3-08d0-4648-b9a3-2fff8512b159.png" referrerpolicy="no-referrer" alt="Bean生命周期源码追踪"></p><p><span>																							</span><span>Bean生命周期源码追踪</span></p><h3 id='111-bean定义和依赖定义有哪些'><span>1.11 Bean定义和依赖定义有哪些？</span></h3><p><span>有三种方式：</span><strong><span>直接编码方式</span></strong><span>、</span><strong><span>配置文件方式</span></strong><span>、</span><strong><span>注解方式</span></strong><span>。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-89f0f50d-a9e4-4dec-b267-cb1a526cb340.png" referrerpolicy="no-referrer" alt="Bean依赖配置方式"></p><p><span>																							</span><span>Bean依赖配置方式</span></p><ul><li><span>直接编码方式：我们一般接触不到直接编码的方式，但其实其它的方式最终都要通过直接编码来实现。</span></li><li><span>配置文件方式：通过 xml、propreties 类型的配置文件，配置相应的依赖关系，Spring 读取配置文件，完成依赖关系的注入。</span></li><li><span>注解方式：注解方式应该是我们用的最多的一种方式了，在相应的地方使用注解修饰，Spring 会扫描注解，完成依赖关系的注入。</span></li></ul><p><span>在Spring中，可以使用配置文件的方式来定义和配置Bean。配置文件可以使用不同的格式，如XML、Java注解、Java配置类等。下面以XML配置文件为例，说明如何通过配置文件来定义和配置Bean。</span></p><ol start='' ><li><p><span>创建配置文件：</span>
<span>在项目中创建一个XML配置文件，通常以</span><code>.xml</code><span>为文件后缀，例如</span><code>applicationContext.xml</code><span>。这个配置文件将包含Bean的定义和其他相关配置信息。</span></p></li><li><p><span>在配置文件中定义Bean：</span>
<span>在配置文件中使用</span><code>&lt;bean&gt;</code><span>元素来定义Bean。</span><code>&lt;bean&gt;</code><span>元素包含了Bean的名称、类路径、构造函数参数、属性值等信息。</span></p><p><span>示例：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.MyBean"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">constructor-arg</span> <span class="cm-attribute">value</span>=<span class="cm-string">"Hello World"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">property</span> <span class="cm-attribute">name</span>=<span class="cm-string">"someProperty"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"Some Value"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">bean</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>上述示例中，定义了一个名为</span><code>myBean</code><span>的Bean，它的类路径为</span><code>com.example.MyBean</code><span>，使用构造函数传递了一个值为</span><code>Hello World</code><span>的参数，并设置了名为</span><code>someProperty</code><span>的属性值为</span><code>Some Value</code><span>。</span></p></li><li><p><span>在代码中获取Bean：</span>
<span>在需要使用Bean的地方，可以通过Spring容器来获取已经定义的Bean实例。可以使用</span><code>ApplicationContext</code><span>接口或通过依赖注入的方式获取Bean。</span></p><p><span>示例：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ApplicationContext</span> <span class="cm-variable">context</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ClassPathXmlApplicationContext</span>(<span class="cm-string">"applicationContext.xml"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">MyBean</span> <span class="cm-variable">myBean</span> <span class="cm-operator">=</span> (<span class="cm-variable">MyBean</span>) <span class="cm-variable">context</span>.<span class="cm-variable">getBean</span>(<span class="cm-string">"myBean"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用myBean对象进行操作</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><p><span>上述示例中，通过</span><code>ApplicationContext</code><span>接口加载配置文件，并通过</span><code>getBean()</code><span>方法根据Bean的名称获取到对应的Bean实例。</span></p></li></ol><p><span>通过以上步骤，就可以通过配置文件来定义和配置Bean。可以根据需要在配置文件中定义多个Bean，并使用它们来构建应用程序的各个组件。</span></p><p><strong><span>如何配置不同Bean之间的依赖关系？</span></strong></p><p><span>在Spring中，可以通过以下方式配置Bean之间的依赖关系：</span></p><ol start='' ><li><p><span>构造函数注入：</span>
<span>可以在Bean的定义中使用构造函数注入来指定依赖关系。在XML配置文件中，使用</span><code>&lt;constructor-arg&gt;</code><span>元素来指定构造函数参数的值或引用其他Bean。</span></p><p><span>示例：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"dependencyBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.DependencyBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"dependentBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.DependentBean"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">constructor-arg</span> <span class="cm-attribute">ref</span>=<span class="cm-string">"dependencyBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">bean</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 131px;"></div><div class="CodeMirror-gutters" style="display: none; height: 131px;"></div></div></div></pre><p><span>上述示例中，</span><code>dependentBean</code><span>依赖于</span><code>dependencyBean</code><span>，通过构造函数注入将</span><code>dependencyBean</code><span>作为参数传递给</span><code>dependentBean</code><span>的构造函数。</span></p></li><li><p><span>属性注入：</span>
<span>可以在Bean的定义中使用属性注入来指定依赖关系。在XML配置文件中，使用</span><code>&lt;property&gt;</code><span>元素来设置Bean的属性值或引用其他Bean。</span></p><p><span>示例：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"dependencyBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.DependencyBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"dependentBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.DependentBean"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">property</span> <span class="cm-attribute">name</span>=<span class="cm-string">"dependency"</span> <span class="cm-attribute">ref</span>=<span class="cm-string">"dependencyBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">bean</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 131px;"></div><div class="CodeMirror-gutters" style="display: none; height: 131px;"></div></div></div></pre><p><span>上述示例中，</span><code>dependentBean</code><span>依赖于</span><code>dependencyBean</code><span>，通过属性注入将</span><code>dependencyBean</code><span>设置到</span><code>dependentBean</code><span>的</span><code>dependency</code><span>属性中。</span></p></li><li><p><span>注解方式：</span>
<span>可以使用注解来声明依赖关系。通过在Bean类中使用</span><code>@Autowired</code><span>、</span><code>@Resource</code><span>等注解来自动注入依赖。</span></p><p><span>示例：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Component</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">DependentBean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-meta">@Autowired</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">DependencyBean</span> <span class="cm-variable">dependency</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 183px;"></div><div class="CodeMirror-gutters" style="display: none; height: 183px;"></div></div></div></pre><p><span>上述示例中，使用</span><code>@Autowired</code><span>注解将</span><code>dependency</code><span>属性自动注入</span><code>DependencyBean</code><span>对象。</span></p></li></ol><p><span>以上是配置依赖关系的几种常见方式。通过适当的配置，Spring容器会根据依赖关系自动解析并注入相关的Bean对象。这样可以方便地管理Bean之间的依赖关系，提高代码的可维护性和灵活性。</span></p><h3 id='112-有哪些依赖注入的方法'><span>1.12 有哪些依赖注入的方法？</span></h3><p><span>Spring 支持</span><strong><span>构造方法注入</span></strong><span>、</span><strong><span>属性注入</span></strong><span>、</span><strong><span>工厂方法注入</span></strong><span>,其中工厂方法注入，又可以分为</span><strong><span>静态工厂方法注入</span></strong><span>和</span><strong><span>非静态工厂方法注入</span></strong><span>。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-491f8444-54ba-4628-b8eb-8418a2197096.png" referrerpolicy="no-referrer" alt="Spring依赖注入方法"></p><p><span>																						</span><span>Spring依赖注入方法</span></p><h3 id='113-spring-有哪些自动装配的方式'><span>1.13 Spring 有哪些自动装配的方式？</span></h3><blockquote><p><strong><span>什么是自动装配？</span></strong></p></blockquote><p><span>Spring IOC 容器知道所有 Bean 的配置信息，此外，通过 Java 反射机制还可以获知实现类的结构信息，如构造方法的结构、属性等信息。掌握所有 Bean 的这些信息后，Spring IOC 容器就可以按照某种规则对容器中的 Bean 进行自动装配，而无须通过显式的方式进行依赖配置。</span></p><p><span>Spring 提供的这种方式，可以按照某些规则进行 Bean 的自动装配，</span><code>&lt;bean&gt;</code><span>元素提供了一个指定自动装配类型的属性：</span><code>autowire=&quot;&lt;自动装配类型&gt;&quot;</code></p><p><strong><span>Spring 提供了哪几种自动装配类型？</span></strong></p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-034120d9-88c7-490b-af07-7d48f3b6b7bc.png" alt="Spring四种自动装配类型" style="zoom:50%;" /></p><p><span>																				</span><span>Spring四种自动装配类型</span></p><ul><li><strong><span>byName</span></strong><span>：根据名称进行自动匹配，假设 Boss 又一个名为 car 的属性，如果容器中刚好有一个名为 car 的 bean，Spring 就会自动将其装配给 Boss 的 car 属性</span></li><li><strong><span>byType</span></strong><span>：根据类型进行自动匹配，假设 Boss 有一个 Car 类型的属性，如果容器中刚好有一个 Car 类型的 Bean，Spring 就会自动将其装配给 Boss 这个属性</span></li><li><strong><span>constructor</span></strong><span>：与 byType 类似， 只不过它是针对构造函数注入而言的。如果 Boss 有一个构造函数，构造函数包含一个 Car 类型的入参，如果容器中有一个 Car 类型的 Bean，则 Spring 将自动把这个 Bean 作为 Boss 构造函数的入参；如果容器中没有找到和构造函数入参匹配类型的 Bean，则 Spring 将抛出异常。</span></li><li><strong><span>autodetect</span></strong><span>：根据 Bean 的自省机制决定采用 byType 还是 constructor 进行自动装配，如果 Bean 提供了默认的构造函数，则采用 byType，否则采用 constructor。</span></li></ul><p><span>以下是一些自动装配的示例：</span></p><ol start='' ><li><p><span>ByName 自动装配：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyBean</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">setOtherBean</span>(<span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">otherBean</span> <span class="cm-operator">=</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">OtherBean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.MyBean"</span> <span class="cm-attribute">autowire</span>=<span class="cm-string">"byName"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"otherBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.OtherBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>在这个示例中，通过设置</span><code>autowire</code><span>属性为</span><code>byName</code><span>，容器会自动将名称为</span><code>otherBean</code><span>的Bean注入到</span><code>myBean</code><span>的</span><code>otherBean</code><span>属性中。</span></p></li><li><p><span>ByType 自动装配：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyBean</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">setOtherBean</span>(<span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">otherBean</span> <span class="cm-operator">=</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">OtherBean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.MyBean"</span> <span class="cm-attribute">autowire</span>=<span class="cm-string">"byType"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"otherBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.OtherBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>在这个示例中，通过设置</span><code>autowire</code><span>属性为</span><code>byType</code><span>，容器会自动将类型为</span><code>OtherBean</code><span>的Bean注入到</span><code>myBean</code><span>的</span><code>otherBean</code><span>属性中。</span></p></li><li><p><span>Constructor 自动装配：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyBean</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">MyBean</span>(<span class="cm-variable">OtherBean</span> <span class="cm-variable">otherBean</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">otherBean</span> <span class="cm-operator">=</span> <span class="cm-variable">otherBean</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">OtherBean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.MyBean"</span> <span class="cm-attribute">autowire</span>=<span class="cm-string">"constructor"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">bean</span> <span class="cm-attribute">id</span>=<span class="cm-string">"otherBean"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"com.example.OtherBean"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>在这个示例中，通过设置</span><code>autowire</code><span>属性为</span><code>constructor</code><span>，容器会根据构造函数参数类型自动注入</span><code>OtherBean</code><span>到</span><code>MyBean</code><span>的构造函数中。</span></p></li></ol><p><strong><span>以上示例展示了几种常见的自动装配方式，通过适当配置，可以方便地实现Bean之间的依赖注入，减少了手动配置的工作量。</span></strong></p><h3 id='114-spring中的bean的作用域'><span>1.14 Spring中的Bean的作用域</span></h3><p><span>Spring 的 Bean 主要支持五种作用域：</span></p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-08a9cb31-5a4f-4224-94cd-0c0f643a57ea.png" alt="Spring Bean支持作用域" style="zoom:80%;" /></p><ul><li><strong><span>singleton</span></strong><span> : 在 Spring 容器仅存在一个 Bean 实例，Bean 以单实例的方式存在，是 Bean 默认的作用域。</span></li><li><strong><span>prototype</span></strong><span> : 每次从容器重调用 Bean 时，都会返回一个新的实例。</span></li></ul><p><strong><span>以下三个作用域于只在 Web 应用中适用：</span></strong></p><ul><li><strong><span>request</span></strong><span> : 每一次 HTTP 请求都会产生一个新的 Bean，该 Bean 仅在当前 HTTP Request 内有效。</span></li><li><strong><span>session</span></strong><span> : 同一个 HTTP Session 共享一个 Bean，不同的 HTTP Session 使用不同的 Bean。</span></li><li><strong><span>globalSession</span></strong><span>：同一个全局 Session 共享一个 Bean，只用于基于 Protlet 的 Web 应用，Spring5 中已经不存在了。</span></li></ul><h3 id='115-spring中的单例bean会存在线程安全问题吗'><span>1.15 Spring中的单例Bean会存在线程安全问题吗？</span></h3><p><span>首先结论在这：Spring 中的单例 Bean</span><strong><span>不是线程安全的</span></strong><span>。</span></p><p><strong><span>因为单例 Bean，是全局只有一个 Bean，所有线程共享。</span></strong><span>如果说单例 Bean，是一个无状态的，也就是线程中的操作不会对 Bean 中的成员变量执行</span><strong><span>查询</span></strong><span>以外的操作，那么这个单例 Bean 是线程安全的。比如 Spring mvc 的 Controller、Service、Dao 等，这些 Bean 大多是无状态的，只关注于方法本身。</span></p><p><span>假如这个 Bean 是有状态的，也就是会对 Bean 中的成员变量进行写操作，那么可能就存在线程安全的问题。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-35dacef4-1a9e-45e1-b3f2-5a91227eb244.png" referrerpolicy="no-referrer" alt="Spring单例Bean线程安全问题"></p><p><span>																				</span><span>Spring单例Bean线程安全问题</span></p><p><strong><span>单例 Bean 线程安全问题怎么解决呢？</span></strong></p><p><span>常见的有这么些解决办法：</span></p><ol start='' ><li><p><span>将 Bean 定义为多例</span></p><p><span>这样每一个线程请求过来都会创建一个新的 Bean，但是这样容器就不好管理 Bean，不能这么办。</span></p></li><li><p><span>在 Bean 对象中尽量避免定义可变的成员变量</span></p><p><span>削足适履了属于是，也不能这么干。</span></p></li><li><p><span>将 Bean 中的成员变量保存在 ThreadLocal 中 ⭐</span></p><p><span>我们知道 ThredLoca 能保证多线程下变量的隔离，可以在类中定义一个 ThreadLocal 成员变量，将需要的可变成员变量保存在 ThreadLocal 里，这是推荐的一种方式。</span></p></li></ol><p><span>1.16 循环依赖</span></p><p><strong><span>什么是循环依赖？</span></strong></p><p><img src="C:\Users\Waitfou\AppData\Roaming\Typora\typora-user-images\image-20230703200036434.png" alt="image-20230703200036434" style="zoom:80%;" /></p><p><span>Spring 循环依赖：简单说就是自己依赖自己，或者和别的 Bean 相互依赖。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-0035fd25-2972-4642-a8ec-ee44a566a5bd.png" referrerpolicy="no-referrer" alt="鸡和蛋"></p><p><span>只有单例的 Bean 才存在循环依赖的情况，</span><strong><span>原型</span></strong><span>(Prototype)情况下，Spring 会直接抛出异常。原因很简单，AB 循环依赖，A 实例化的时候，发现依赖 B，创建 B 实例，创建 B 的时候发现需要 A，创建 A1 实例……无限套娃，直接把系统干垮。</span></p><p><strong><span>Spring 可以解决哪些情况的循环依赖？</span></strong></p><p><span>Spring 不支持基于构造器注入的循环依赖，但是假如 AB 循环依赖，如果一个是构造器注入，一个是 setter 注入呢？</span></p><p><span>看看几种情形：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-37bb576d-b4af-42ed-91f4-d846ceb012b6.png" referrerpolicy="no-referrer" alt="循环依赖的几种情形"></p><p><span>																								</span><span>循环依赖的几种情形</span></p><p><span>第四种可以而第五种不可以的原因是 Spring 在创建 Bean 时默认会根据自然排序进行创建，所以 A 会先于 B 进行创建。</span></p><p><strong><span>所以简单总结，当循环依赖的实例都采用 setter 方法注入的时候，Spring 可以支持，都采用构造器注入的时候，不支持，构造器注入和 setter 注入同时存在的时候，看天。</span></strong></p><h3 id='116-spring怎么解决循环依赖'><span>1.16 Spring怎么解决循环依赖</span></h3><blockquote><p><span>PS：其实正确答案是开发人员做好设计，别让 Bean 循环依赖，但是没办法，面试官不想听这个。</span></p></blockquote><p><span>我们都知道，单例 Bean 初始化完成，要经历三步：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-867066f1-49d1-4e57-94f9-4c66a3a8797e.png" referrerpolicy="no-referrer" alt="Bean初始化步骤"></p><p><span>																							</span><span>Bean初始化步骤</span></p><p><span>注入就发生在第二步，</span><strong><span>属性赋值</span></strong><span>，结合这个过程，Spring 通过</span><strong><span>三级缓存</span></strong><span>解决了循环依赖：</span></p><ol start='' ><li><span>一级缓存 : </span><code>Map&lt;String,Object&gt;</code><span> </span><strong><span>singletonObjects</span></strong><span>，单例池，用于保存实例化、属性赋值（注入）、初始化完成的 bean 实例</span></li><li><span>二级缓存 : </span><code>Map&lt;String,Object&gt;</code><span> </span><strong><span>earlySingletonObjects</span></strong><span>，早期曝光对象，用于保存实例化完成的 bean 实例</span></li><li><span>三级缓存 : </span><code>Map&lt;String,ObjectFactory&lt;?&gt;&gt;</code><span> </span><strong><span>singletonFactories</span></strong><span>，早期曝光对象工厂，用于保存 bean 创建工厂，以便于后面扩展有机会创建代理对象。</span></li></ol><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-01d92863-a2cb-4f61-8d8d-30ecf0279b28.png" referrerpolicy="no-referrer" alt="三级缓存"><span>																										</span><span>三级缓存</span></p><p><span>我们来看一下三级缓存解决循环依赖的过程：</span></p><p><span>当 A、B 两个类发生循环依赖时： </span><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-cfc09f84-f8e1-4702-80b6-d115843e81fe.png" referrerpolicy="no-referrer" alt="循环依赖"></p><p><span>A 实例的初始化过程：</span></p><ol start='' ><li><span>创建 A 实例，实例化的时候把 A 对象⼯⼚放⼊三级缓存，表示 A 开始实例化了，虽然我这个对象还不完整，但是先曝光出来让大家知道</span></li></ol><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-1a8bdc29-ff43-4ff4-9b61-3eedd9da59b3.png" referrerpolicy="no-referrer" alt="1"></p><ol start='2' ><li><span>A 注⼊属性时，发现依赖 B，此时 B 还没有被创建出来，所以去实例化 B</span></li><li><span>同样，B 注⼊属性时发现依赖 A，它就会从缓存里找 A 对象。依次从⼀级到三级缓存查询 A，从三级缓存通过对象⼯⼚拿到 A，发现 A 虽然不太完善，但是存在，把 A 放⼊⼆级缓存，同时删除三级缓存中的 A，此时，B 已经实例化并且初始化完成，把 B 放入⼀级缓存。</span></li></ol><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-bf2507bf-96aa-4b88-a58b-7ec41d11bc70.png" referrerpolicy="no-referrer" alt="2"></p><ol start='4' ><li><span>接着 A 继续属性赋值，顺利从⼀级缓存拿到实例化且初始化完成的 B 对象，A 对象创建也完成，删除⼆级缓存中的 A，同时把 A 放⼊⼀级缓存</span></li><li><span>最后，⼀级缓存中保存着实例化、初始化都完成的 A、B 对象</span></li></ol><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-022f7cb9-2c83-4fe9-b252-b02bd0fb2435.png" referrerpolicy="no-referrer" alt="5"><span>5</span></p><p><span>所以，我们就知道为什么 Spring 能解决 setter 注入的循环依赖了，因为实例化和属性赋值是分开的，所以里面有操作的空间。如果都是构造器注入的化，那么都得在实例化这一步完成注入，所以自然是无法支持了。</span></p><h3 id='118-为什么要三级缓存二级不行吗'><span>1.18 为什么要三级缓存？二级不行吗？</span></h3><p><span>不行，主要是为了</span><strong><span>⽣成代理对象</span></strong><span>。如果是没有代理的情况下，使用二级缓存解决循环依赖也是 OK 的。但是如果存在代理，三级没有问题，二级就不行了。</span></p><p><span>因为三级缓存中放的是⽣成具体对象的匿名内部类，获取 Object 的时候，它可以⽣成代理对象，也可以返回普通对象。使⽤三级缓存主要是为了保证不管什么时候使⽤的都是⼀个对象。</span></p><p><span>假设只有⼆级缓存的情况，往⼆级缓存中放的显示⼀个普通的 Bean 对象，Bean 初始化过程中，通过 BeanPostProcessor 去⽣成代理对象之后，覆盖掉⼆级缓存中的普通 Bean 对象，那么可能就导致取到的 Bean 对象不一致了。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-6ece8a46-25b1-459b-8cfa-19fc696dd7d6.png" referrerpolicy="no-referrer" alt="二级缓存不行的原因"><span>																							</span><span>二级缓存不行的原因</span></p><h3 id='119-autowired的实现原理'><span>1.19 @Autowired的实现原理</span></h3><p><span>@Autowired是Spring框架提供的注解，用于自动装配Bean之间的依赖关系。它的实现原理主要涉及以下几个方面：</span></p><ol start='' ><li><span>依赖注入：</span>
<span>@Autowired注解可以用于字段、构造方法和Setter方法上。当Spring容器启动时，会扫描带有@Autowired注解的Bean，根据注解所标注的依赖类型，在容器中查找匹配的Bean，并将其注入到相应的位置。</span></li><li><span>自动装配的解析过程：</span>
<span>Spring容器在进行自动装配时，会通过BeanPostProcessor接口的实现类进行解析和处理。其中，AutowiredAnnotationBeanPostProcessor是用于处理@Autowired注解的后处理器之一。它会在Bean实例化之后，对带有@Autowired注解的字段、构造方法和Setter方法进行解析，完成自动装配的过程。</span></li><li><span>依赖查找与匹配：</span>
<span>在自动装配过程中，Spring容器会根据注解标注的依赖类型，通过依赖查找的方式，从容器中获取匹配的Bean。匹配过程通常是基于Bean的类型进行的，如果存在多个匹配的Bean，则根据一定的规则进行选择，例如按照Bean的名称、限定符等。</span></li><li><span>依赖注入的方式：</span>
<span>自动装配可以通过字段注入、构造方法注入和Setter方法注入来实现。对于字段注入，AutowiredAnnotationBeanPostProcessor会直接将匹配的Bean赋值给字段；对于构造方法注入，容器会选择合适的构造方法，并将匹配的Bean作为参数传递；对于Setter方法注入，容器会调用合适的Setter方法，并将匹配的Bean作为参数传递。</span></li></ol><p><span>总的来说，@Autowired注解的实现原理是通过BeanPostProcessor后处理器解析注解，使用依赖查找的方式在容器中查找匹配的Bean，并进行依赖注入。这样可以实现方便的自动装配，减少手动配置的工作量。</span></p><h2 id='2-spring-aop'><span>2 Spring AOP</span></h2><h3 id='21-什么是aop'><span>2.1 什么是AOP?</span></h3><p><span>AOP：面向切面编程。简单说，就是把一些业务逻辑中的相同的代码抽取到一个独立的模块中，让业务逻辑更加清爽。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-09dbcda4-7c1b-42d6-8520-1a5fc84abbde.png" referrerpolicy="no-referrer" alt="横向抽取"></p><p><span>																										</span><span>横向抽取</span></p><p><span>具体来说，假如我现在要 crud 写一堆业务，可是如何业务代码前后前后进行打印日志和参数的校验呢？</span></p><p><span>我们可以把</span><code>日志记录</code><span>和</span><code>数据校验</code><span>可重用的功能模块分离出来，然后在程序的执行的合适的地方动态地植入这些代码并执行。这样就简化了代码的书写。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-4754b4c0-0356-4077-a2f9-55e246cf8ba0.png" referrerpolicy="no-referrer" alt="AOP应用示例"></p><p><span>																									</span><span>AOP应用示例</span></p><p><span>业务逻辑代码中没有参和通用逻辑的代码，业务模块更简洁，只包含核心业务代码。实现了业务逻辑和通用逻辑的代码分离，便于维护和升级，降低了业务逻辑和通用逻辑的耦合性。</span></p><p><span>AOP 可以将遍布应用各处的功能分离出来形成可重用的组件。在</span><strong><span>编译期间、装载期间或运行期间</span></strong><span>实现在不修改源代码的情况下给程序动态添加功能。从而实现对业务逻辑的隔离，提高代码的模块化能力。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-2b9859e5-019c-4e87-a449-990d3deae135.png" referrerpolicy="no-referrer" alt="Java语言执行过程"></p><p><span>																						</span><span>Java语言执行过程</span></p><p><span>AOP 的核心其实就是</span><strong><span>动态代理</span></strong><span>，如果是实现了接口的话就会使用 JDK 动态代理，否则使用 CGLIB 代理，主要应用于处理一些具有横切性质的系统级服务，如日志收集、事务管理、安全检查、缓存、对象池管理等。</span></p><blockquote><p><strong><span>AOP 有哪些核心概念？</span></strong></p></blockquote><ul><li><p><strong><span>切面</span></strong><span>（Aspect）：类是对物体特征的抽象，切面就是对横切关注点的抽象</span></p></li><li><p><strong><span>连接点</span></strong><span>（Joinpoint）：被拦截到的点，因为 Spring 只支持方法类型的连接点，所以在 Spring 中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</span></p></li><li><p><strong><span>切点</span></strong><span>（Pointcut）：对连接点进行拦截的定位</span></p></li><li><p><strong><span>通知</span></strong><span>（Advice）：所谓通知指的就是指拦截到连接点之后要执行的代码，也可以称作</span><strong><span>增强</span></strong></p></li><li><p><strong><span>目标对象</span></strong><span> （Target）：代理的目标对象</span></p></li><li><p><strong><span>织入</span></strong><span>（Weabing）：织入是将增强添加到目标类的具体连接点上的过程。</span></p><ul><li><p><span>编译期织入：切面在目标类编译时被织入</span></p></li><li><p><span>类加载期织入：切面在目标类加载到 JVM 时被织入。需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码。</span></p></li><li><p><span>运行期织入：切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP 容器会为目标对象动态地创建一个代理对象。SpringAOP 就是以这种方式织入切面。</span></p><p><span>Spring 采用运行期织入，而 AspectJ 采用编译期织入和类加载器织入。</span></p></li></ul></li><li><p><strong><span>引介</span></strong><span>（introduction）：引介是一种特殊的增强，可以动态地为类添加一些属性和方法</span></p></li></ul><blockquote><p><strong><span>AOP 有哪些环绕方式？</span></strong></p></blockquote><p><span>AOP 一般有 </span><strong><span>5 种</span></strong><span>环绕方式：</span></p><ul><li><span>前置通知 (@Before)</span></li><li><span>返回通知 (@AfterReturning)</span></li><li><span>异常通知 (@AfterThrowing)</span></li><li><span>后置通知 (@After)</span></li><li><span>环绕通知 (@Around)</span></li></ul><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-320fa34f-6620-419c-b17a-4f516a83caeb.png" referrerpolicy="no-referrer" alt="环绕方式"><span>环绕方式</span></p><p><strong><span>多个切面的情况下，可以通过 @Order 指定先后顺序，数字越小，优先级越高。</span></strong></p><p><strong><span>概念详解：</span></strong></p><p><strong><span>切面：</span></strong></p><p><span>切面（Aspect）是面向切面编程（AOP）的核心概念之一。在软件开发中，切面用于描述横切关注点（Cross-cutting Concerns），即那些与核心业务逻辑无关但又散布在应用程序各个模块中的功能或行为。</span></p><p><span>横切关注点可以是日志记录、事务管理、安全性检查、性能监控等。这些关注点在应用程序的多个模块中重复出现，没有明显的层次结构，通常会导致代码重复、耦合性增加和可维护性降低。通过使用切面，可以将这些横切关注点从核心业务逻辑中分离出来，实现更好的代码模块化和可维护性。</span></p><p><span>切面由切点（Pointcut）和通知（Advice）组成：</span></p><ul><li><span>切点定义了在应用程序中哪些位置进行横切操作，通常使用表达式或规则来匹配目标方法或类。</span></li><li><span>通知定义了在切点位置执行的具体操作，可以是在切点前执行的操作（前置通知），切点后执行的操作（后置通知），切点发生异常时执行的操作（异常通知）等。</span></li></ul><p><span>除了切点和通知，切面还可以包含其他元素，如引入（Introduction），用于向目标对象添加新的方法或属性；以及切面优先级等配置。</span></p><p><span>使用切面，可以将横切关注点统一管理，将其与核心业务逻辑解耦，提高代码的可重用性和可维护性。在Spring框架中，切面的实现是通过AOP的方式，通常使用注解或XML配置来定义切面和切点，然后由AOP框架在运行时动态地将切面织入到目标对象中。这样，切面的功能就能在应用程序中自动生效，而不需要手动干预每个被影响的类或方法。</span></p><p><span>下面是一个使用Spring框架的切面示例：</span></p><p><span>首先，定义一个切面类 </span><code>LoggingAspect</code><span>，它包含一个前置通知和一个后置通知：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">JoinPoint</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">AfterReturning</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">Aspect</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">Before</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">stereotype</span>.<span class="cm-variable">Component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Aspect</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">LoggingAspect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Before</span>(<span class="cm-string">"execution(* com.example.service.*.*(..))"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">beforeAdvice</span>(<span class="cm-variable">JoinPoint</span> <span class="cm-variable">joinPoint</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Before method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@AfterReturning</span>(<span class="cm-variable">pointcut</span> <span class="cm-operator">=</span> <span class="cm-string">"execution(* com.example.service.*.*(..))"</span>, <span class="cm-variable">returning</span> <span class="cm-operator">=</span> <span class="cm-string">"result"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">afterReturningAdvice</span>(<span class="cm-variable">JoinPoint</span> <span class="cm-variable">joinPoint</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">result</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"After method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Result: "</span> <span class="cm-operator">+</span> <span class="cm-variable">result</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 575px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><p><span>在上述代码中，</span><code>@Aspect</code><span> 注解将类标记为切面类，</span><code>@Component</code><span> 注解将它声明为Spring组件，使其能够被Spring容器扫描和管理。</span></p><p><code>@Before</code><span> 注解用于定义前置通知，它指定了切点表达式 </span><code>execution(* com.example.service.*.*(..))</code><span>，表示匹配 </span><code>com.example.service</code><span> 包下的所有方法。在 </span><code>beforeAdvice</code><span> 方法内部，我们可以执行一些在目标方法执行之前需要执行的逻辑。</span></p><p><code>@AfterReturning</code><span> 注解用于定义后置通知，它也指定了切点表达式，并可以通过 </span><code>returning</code><span> 属性指定方法的返回值。在 </span><code>afterReturningAdvice</code><span> 方法内部，我们可以获取目标方法的返回值并执行一些后续处理。</span></p><p><span>接下来，我们创建一个 </span><code>UserService</code><span> 接口和实现类 </span><code>UserServiceImpl</code><span>：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">UserService</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">addUser</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Service</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">UserServiceImpl</span> <span class="cm-keyword">implements</span> <span class="cm-variable">UserService</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">addUser</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Adding user: "</span> <span class="cm-operator">+</span> <span class="cm-variable">username</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 288px;"></div><div class="CodeMirror-gutters" style="display: none; height: 288px;"></div></div></div></pre><p><span>最后，在Spring的配置文件中配置相关组件：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="xml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">context:component-scan</span> <span class="cm-attribute">base-package</span>=<span class="cm-string">"com.example"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">aop:aspectj-autoproxy</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>在上述配置中，</span><code>&lt;context:component-scan&gt;</code><span> 用于扫描并注册Spring组件，</span><code>&lt;aop:aspectj-autoproxy&gt;</code><span> 用于启用AspectJ自动代理。</span></p><p><span>现在，当我们调用 </span><code>UserService</code><span> 的 </span><code>addUser</code><span> 方法时，切面将自动应用于该方法。例如：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Main</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ApplicationContext</span> <span class="cm-variable">context</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ClassPathXmlApplicationContext</span>(<span class="cm-string">"applicationContext.xml"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UserService</span> <span class="cm-variable">userService</span> <span class="cm-operator">=</span> <span class="cm-variable">context</span>.<span class="cm-variable">getBean</span>(<span class="cm-variable">UserService</span>.<span class="cm-keyword">class</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">userService</span>.<span class="cm-variable">addUser</span>(<span class="cm-string">"John Doe"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 183px;"></div><div class="CodeMirror-gutters" style="display: none; height: 183px;"></div></div></div></pre><p><span>输出结果：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Before method: addUser</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Adding user: John Doe</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">After method: addUser</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Result: null</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>可以看到，切面的前置通知在目标方法执行之前被调用，后置通知在目标方法执行之后被调用，并且能够获取到目标方法的返回值。</span></p><p><span>在切面中，我们可以实现各种类型的通知，包括前置通知（Before advice）、后置通知（After advice）、异常通知（After throwing advice）和环绕通知（Around advice）。每种通知类型都有不同的执行时机和处理方式。</span></p><p><span>下面是一个切面类的示例，演示了不同类型的通知：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">JoinPoint</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">ProceedingJoinPoint</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">After</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">AfterThrowing</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">Around</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">Aspect</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">aspectj</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">Before</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">stereotype</span>.<span class="cm-variable">Component</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Aspect</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Component</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">LoggingAspect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Before</span>(<span class="cm-string">"execution(* com.example.service.*.*(..))"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">beforeAdvice</span>(<span class="cm-variable">JoinPoint</span> <span class="cm-variable">joinPoint</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Before method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@After</span>(<span class="cm-string">"execution(* com.example.service.*.*(..))"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">afterAdvice</span>(<span class="cm-variable">JoinPoint</span> <span class="cm-variable">joinPoint</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"After method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@AfterThrowing</span>(<span class="cm-variable">pointcut</span> <span class="cm-operator">=</span> <span class="cm-string">"execution(* com.example.service.*.*(..))"</span>, <span class="cm-variable">throwing</span> <span class="cm-operator">=</span> <span class="cm-string">"exception"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">afterThrowingAdvice</span>(<span class="cm-variable">JoinPoint</span> <span class="cm-variable">joinPoint</span>, <span class="cm-variable">Exception</span> <span class="cm-variable">exception</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Exception thrown in method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Exception message: "</span> <span class="cm-operator">+</span> <span class="cm-variable">exception</span>.<span class="cm-variable">getMessage</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Around</span>(<span class="cm-string">"execution(* com.example.service.*.*(..))"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">aroundAdvice</span>(<span class="cm-variable">ProceedingJoinPoint</span> <span class="cm-variable">joinPoint</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">Throwable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Before method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">proceed</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Exception thrown in method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Exception message: "</span> <span class="cm-operator">+</span> <span class="cm-variable">e</span>.<span class="cm-variable">getMessage</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"After method: "</span> <span class="cm-operator">+</span> <span class="cm-variable">joinPoint</span>.<span class="cm-variable">getSignature</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1150px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1150px;"></div></div></div></pre><p><span>在上述代码中，我们添加了三种新的通知类型：</span></p><ul><li><code>@After</code><span> 注解用于定义后置通知，它会在目标方法执行后调用。在 </span><code>afterAdvice</code><span> 方法中，我们可以执行一些在目标方法执行之后需要执行的逻辑。</span></li><li><code>@AfterThrowing</code><span> 注解用于定义异常通知，它会在目标方法抛出异常时调用。在 </span><code>afterThrowingAdvice</code><span> 方法中，我们可以获取抛出的异常并执行相应的处理逻辑。</span></li><li><code>@Around</code><span> 注解用于定义环绕通知，它会在目标方法执行前后进行处理。在 </span><code>aroundAdvice</code><span> 方法中，我们可以使用 </span><code>ProceedingJoinPoint</code><span> 对象手动控制目标方法的执行，并在适当的时机执行额外的逻辑。</span></li></ul><p><span>通过这些不同类型的通知，我们可以更精细地控制切面的行为，并在目标方法的不同阶段执行特定的操作。这提供了更大的灵活性和功能扩展性。</span></p><p><strong><span>连接点：</span></strong></p><p><span>在AOP（面向切面编程）中，连接点（JoinPoint）表示在应用程序执行过程中可以插入切面的特定点。它是程序执行过程中的一个特定位置，可以是方法的调用、方法的执行、异常的抛出等。换句话说，连接点是程序执行中能够被拦截的点。</span></p><p><span>连接点是切面可以插入的具体位置，它由两个主要方面定义：</span></p><ol start='' ><li><span>方法的执行：连接点可以是正在执行的方法，也可以是方法的调用。在方法执行过程中，连接点可以是方法的开始、结束或异常抛出的位置。</span></li><li><span>类型：连接点可以是类级别的，也可以是对象级别的。类级别的连接点是指所有匹配的类中的方法，而对象级别的连接点是指特定对象上的方法。</span></li></ol><p><span>在AOP中，切面可以通过定义切点（Pointcut）来选择感兴趣的连接点。切点是一种表达式，它定义了连接点的匹配规则。通过切点，切面可以确定在何处以及何时执行通知（Advice）。</span></p><p><span>连接点和切点是AOP中两个重要的概念，它们一起提供了一种机制，使得我们可以在程序执行的特定位置插入切面逻辑，从而实现横切关注点的处理。</span></p><p><span>在AOP（面向切面编程）中，切点（Pointcut）用于定义在何处应该应用切面的通知（Advice）。切点指定了在程序执行过程中哪些连接点（JoinPoint）应该被拦截和应用切面逻辑。</span></p><p><span>切点由一个表达式定义，该表达式描述了连接点的选择规则。它可以是一个类名、一个方法名、一个注解等，以匹配特定的连接点。通过切点，我们可以精确地确定在哪些位置应该应用切面。</span></p><p><span>切点表达式使用切点语言（Pointcut Expression Language）来描述连接点的选择规则。切点语言提供了一套语法和规则，用于匹配连接点的特征。常用的切点语言包括 AspectJ 中的切点表达式和 Spring AOP 中的切点表达式。</span></p><p><span>以下是一个示例切点的定义：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Pointcut</span>(<span class="cm-string">"execution(* com.example.service.*.*(..))"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">serviceMethods</span>() {}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>在上述代码中，我们定义了一个切点 </span><code>serviceMethods()</code><span>，它使用切点表达式 </span><code>&quot;execution(* com.example.service.*.*(..))&quot;</code><span> 来匹配 </span><code>com.example.service</code><span> 包下的所有方法。这个切点表示我们希望应用切面逻辑到这些方法上。</span></p><p><span>切点允许我们精确地选择要拦截的连接点，并在这些连接点上应用切面的通知。通过定义不同的切点，我们可以将切面逻辑应用到特定的位置，实现对程序行为的控制和扩展。</span></p><p><strong><span>通知：</span></strong></p><p><span>在AOP（面向切面编程）中，通知（Advice）是切面的一部分，它定义了在切面的特定连接点（JoinPoint）上执行的逻辑。通知是在切面中定义的具体行为，用于在程序执行过程中插入切面的代码。</span></p><p><span>通知可以在连接点的不同阶段执行，以实现不同的功能。常见的通知类型包括：</span></p><ol start='' ><li><span>前置通知（Before advice）：在目标方法执行之前执行的通知。它可以用于执行一些预处理操作或验证。</span></li><li><span>后置通知（After advice）：在目标方法执行之后（无论是否发生异常）执行的通知。它可以用于执行一些清理操作或记录日志。</span></li><li><span>返回通知（After returning advice）：在目标方法成功执行并返回结果后执行的通知。它可以用于处理返回值或执行一些后续操作。</span></li><li><span>异常通知（After throwing advice）：在目标方法抛出异常后执行的通知。它可以用于处理异常情况或执行一些特定的异常处理逻辑。</span></li><li><span>环绕通知（Around advice）：在目标方法执行前后都执行的通知。它可以用于完全控制目标方法的执行过程，包括可以选择是否调用目标方法以及在执行前后执行其他逻辑。</span></li></ol><p><span>通知通过在切点上应用切面逻辑来实现特定的行为。通过选择合适的通知类型和在切点上定义切面，我们可以实现对程序执行过程中不同阶段的控制和增强。通知是切面编程的关键组成部分，它使得我们能够将横切关注点与核心业务逻辑分离，并以模块化的方式实现可重用的切面。</span></p><p><strong><span>目标对象：</span></strong></p><p><span>目标对象（Target Object）是在面向切面编程（AOP）中被拦截和增强的对象。它是应用程序中实际执行业务逻辑的对象，通常是我们希望应用切面的对象。</span></p><p><span>在AOP中，切面（Aspect）是在特定连接点（Join Point）上应用的逻辑，例如方法的调用或方法的执行。切面通过在连接点上织入代码来实现特定的行为，这些行为可以是前置处理、后置处理、异常处理等。而目标对象是这些切面所拦截和增强的对象，它是实际执行业务逻辑的对象。</span></p><p><span>目标对象通常是应用程序中的普通对象，例如服务类、数据访问对象、控制器等。它包含了实际的业务逻辑和方法，需要被切面所增强。</span></p><p><span>当应用程序执行到目标对象的方法时，切面可以在特定的连接点上插入额外的逻辑。这样，切面就能够对目标对象的行为进行拦截、修改或增强，实现与业务逻辑的解耦和横切关注点的处理。</span></p><p><span>目标对象是AOP中一个重要的概念，它与切面一起协同工作，实现了横切关注点的处理和业务逻辑的解耦，提高了代码的模块化和可重用性。</span></p><h3 id='22-什么是jdk动态代理和cglib代理'><span>2.2 什么是JDK动态代理和CGLIB代理？</span></h3><p><span>Spring 的 AOP 是通过动态代理来实现的，动态代理主要有两种方式 JDK 动态代理和 Cglib 动态代理，这两种动态代理的使用和原理有些不同。</span></p><p><strong><span>JDK 动态代理</span></strong></p><ol start='' ><li><strong><span>Interface</span></strong><span>：对于 JDK 动态代理，目标类需要实现一个 Interface。</span></li><li><strong><span>InvocationHandler</span></strong><span>：InvocationHandler 是一个接口，可以通过实现这个接口，定义横切逻辑，再通过反射机制（invoke）调用目标类的代码，在次过程，可能包装逻辑，对目标方法进行前置后置处理。</span></li><li><strong><span>Proxy</span></strong><span>：Proxy 利用 InvocationHandler 动态创建一个符合目标类实现的接口的实例，生成目标类的代理对象。</span></li></ol><p><strong><span>CgLib 动态代理</span></strong></p><ol start='' ><li><span>使用 JDK 创建代理有一大限制，它只能为接口创建代理实例，而 CgLib 动态代理就没有这个限制。</span></li><li><span>CgLib 动态代理是使用字节码处理框架 </span><strong><span>ASM</span></strong><span>，其原理是通过字节码技术为一个类创建子类，并在子类中采用方法拦截的技术拦截所有父类方法的调用，顺势织入横切逻辑。</span></li><li><strong><span>CgLib</span></strong><span> 创建的动态代理对象性能比 JDK 创建的动态代理对象的性能高不少，但是 CGLib 在创建代理对象时所花费的时间却比 JDK 多得多，所以对于单例的对象，因为无需频繁创建对象，用 CGLib 合适，反之，使用 JDK 方式要更为合适一些。同时，由于 CGLib 由于是采用动态创建子类的方法，对于 final 方法，无法进行代理。</span></li></ol><p><span>JDK动态代理和CGLIB代理是两种常见的Java代理实现方式，它们都用于在运行时生成代理对象并实现对目标对象的代理控制。它们的主要区别在于生成代理对象的方式和适用范围。</span></p><ol start='' ><li><p><span>JDK动态代理：</span></p><ul><li><span>基于接口：JDK动态代理是基于接口的代理实现。它要求目标对象实现一个或多个接口。</span></li><li><span>使用</span><code>java.lang.reflect.Proxy</code><span>类：JDK动态代理通过</span><code>java.lang.reflect.Proxy</code><span>类生成代理对象。</span></li><li><span>代理对象继承</span><code>Proxy</code><span>类并实现目标接口：JDK动态代理生成的代理对象继承</span><code>Proxy</code><span>类并实现目标对象的接口，它们之间存在一层代理关系。</span></li><li><span>使用</span><code>InvocationHandler</code><span>接口进行代理控制：JDK动态代理使用</span><code>InvocationHandler</code><span>接口来实现对目标方法的代理控制，代理对象的方法调用都会被转发到</span><code>InvocationHandler</code><span>的</span><code>invoke()</code><span>方法中。</span></li></ul></li><li><p><span>CGLIB代理：</span></p><ul><li><span>基于继承：CGLIB代理是基于继承的代理实现。它可以代理没有实现接口的类。</span></li><li><span>使用CGLIB库：CGLIB代理使用CGLIB库生成代理对象。</span></li><li><span>代理对象继承目标类：CGLIB代理生成的代理对象直接继承目标类，它们之间存在一层继承关系。</span></li><li><span>通过覆盖方法进行代理控制：CGLIB代理通过覆盖目标类的方法来实现对目标方法的代理控制。</span></li></ul></li></ol><p><span>JDK动态代理和CGLIB代理各有优缺点：</span></p><ul><li><span>JDK动态代理的优点是支持基于接口的代理，适用于对实现了接口的目标对象进行代理。缺点是无法代理没有实现接口的类。</span></li><li><span>CGLIB代理的优点是可以代理没有实现接口的类，更加灵活。缺点是生成代理对象的过程相对复杂，性能稍低于JDK动态代理。</span></li></ul><p><span>在选择使用JDK动态代理还是CGLIB代理时，需要根据具体的场景和需求进行选择。如果目标对象实现了接口，且对代理性能要求较高，可以选择JDK动态代理；如果目标对象没有实现接口或对代理性能要求不高，可以选择CGLIB代理。</span></p><h3 id='23-spring-aop和aspectj-aop区别'><span>2.3 Spring AOP和AspectJ AOP区别？</span></h3><p><strong><span>Spring AOP</span></strong></p><p><span>Spring AOP 属于</span><code>运行时增强</code><span>，主要具有如下特点：</span></p><ol start='' ><li><span>基于动态代理来实现，默认如果使用接口的，用 JDK 提供的动态代理实现，如果是方法则使用 CGLIB 实现</span></li><li><span>Spring AOP 需要依赖 IOC 容器来管理，并且只能作用于 Spring 容器，使用纯 Java 代码实现</span></li><li><span>在性能上，由于 Spring AOP 是基于</span><strong><span>动态代理</span></strong><span>来实现的，在容器启动时需要生成代理实例，在方法调用上也会增加栈的深度，使得 Spring AOP 的性能不如 AspectJ 的那么好。</span></li><li><span>Spring AOP 致力于解决企业级开发中最普遍的 AOP(方法织入)。</span></li></ol><p><strong><span>AspectJ</span></strong></p><p><span>AspectJ 是一个易用的功能强大的 AOP 框架，属于</span><code>编译时增强</code><span>， 可以单独使用，也可以整合到其它框架中，是 AOP 编程的完全解决方案。AspectJ 需要用到单独的编译器 ajc。</span></p><p><span>AspectJ 属于</span><strong><span>静态织入</span></strong><span>，通过修改代码来实现，在实际运行之前就完成了织入，所以说它生成的类是没有额外运行时开销的，一般有如下几个织入的时机：</span></p><ol start='' ><li><span>编译期织入（Compile-time weaving）：如类 A 使用 AspectJ 添加了一个属性，类 B 引用了它，这个场景就需要编译期的时候就进行织入，否则没法编译类 B。</span></li><li><span>编译后织入（Post-compile weaving）：也就是已经生成了 .class 文件，或已经打成 jar 包了，这种情况我们需要增强处理的话，就要用到编译后织入。</span></li><li><span>类加载后织入（Load-time weaving）：指的是在加载类的时候进行织入，要实现这个时期的织入，有几种常见的方法</span></li></ol><p><span>整体对比如下：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/image-20230704101211490-168931549363762.png" referrerpolicy="no-referrer" alt="image-20230704101211490"></p><p><span>																						</span><span>Spring AOP和AspectJ对比</span></p><h2 id='3-事务'><span>3 事务</span></h2><p><span>Spring 事务的本质其实就是数据库对事务的支持，没有数据库的事务支持，Spring 是无法提供事务功能的。Spring 只提供统一事务管理接口，具体实现都是由各数据库自己实现，数据库事务的提交和回滚是通过数据库自己的事务机制实现。</span></p><h3 id='31-事务的种类'><span>3.1 事务的种类</span></h3><p><span>Spring 支持</span><code>编程式事务</code><span>管理和</span><code>声明式</code><span>事务管理两种方式：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-d3ee77fa-926d-4c39-91f8-a8b1544a9134.png" referrerpolicy="no-referrer" alt="Spring事务分类"></p><p><span>																					</span><span> </span><span>		</span><span>Spring事务分类</span></p><ol start='' ><li><span>编程式事务</span></li></ol><p><span>编程式事务管理使用 TransactionTemplate，需要显式执行事务。</span></p><ol start='2' ><li><p><span>声明式事务</span></p><p><span>		</span><span>声明式事务管理建立在 AOP 之上的。其本质是通过 AOP 功能，对方法前后进行拦截，将事务处理的功能编织到拦截的方法中，</span><strong><span>也就是在目标方法开始之前启动一个事务，在执行完目标方法之后根据执行情况提交或者回滚事务</span></strong></p><p><span>		</span><span>优点是不需要在业务逻辑代码中掺杂事务管理的代码，</span><strong><span>只需在配置文件中做相关的事务规则声明或通过 @Transactional 注解的方式，便可以将事务规则应用到业务逻辑中，减少业务代码的污染。</span></strong><span>唯一不足地方是，最细粒度只能作用到方法级别，无法做到像编程式事务那样可以作用到代码块级别。</span></p></li></ol><h3 id='32-spring的事务隔离级别'><span>3.2 Spring的事务隔离级别</span></h3><p><span>Spring 的接口 TransactionDefinition 中定义了表示隔离级别的常量，当然其实主要还是对应数据库的事务隔离级别：</span></p><ol start='' ><li><span>ISOLATION_DEFAULT：使用后端数据库默认的隔离界别，MySQL 默认可重复读，Oracle 默认读已提交。</span></li><li><span>ISOLATION_READ_UNCOMMITTED：读未提交</span></li><li><span>ISOLATION_READ_COMMITTED：读已提交</span></li><li><span>ISOLATION_REPEATABLE_READ：可重复读</span></li><li><span>ISOLATION_SERIALIZABLE：串行化</span></li></ol><h3 id='33-spring-的事务传播机制'><span>3.3 Spring 的事务传播机制？</span></h3><p><span>		</span><span>Spring 事务的传播机制说的是，当多个事务同时存在的时候——一般指的是多个事务方法相互调用时，Spring 如何处理这些事务的行为。</span></p><p><span>		</span><span>事务传播机制是使用简单的 ThreadLocal 实现的，所以，如果调用的方法是在新线程调用的，事务传播实际上是会失效的。</span></p><p><span>		</span><span>事务的传播机制是指在多个事务方法相互调用的情况下，事务应该如何传播和管理。</span><strong><span>Spring框架提供了多种事务传播行为，可以通过注解或编程方式进行配置。</span></strong></p><p><strong><span>常见的事务传播行为包括：</span></strong></p><ol start='' ><li><span>REQUIRED（默认）：如果当前存在事务，则加入该事务，如果没有事务，则新建一个事务。这是最常用的传播行为，多个事务方法在同一事务中运行，如果外部没有事务，则创建新的事务。</span></li><li><span>REQUIRES_NEW：每个方法都会新建一个独立的事务，如果当前存在事务，则将其挂起。每个方法独立运行，不受外部事务的影响。</span></li><li><span>SUPPORTS：如果当前存在事务，则加入该事务，如果没有事务，则以非事务方式运行。多个事务方法可以在事务中运行，也可以在非事务中运行。</span></li><li><span>NOT_SUPPORTED：以非事务方式运行，如果当前存在事务，则将其挂起。多个事务方法以非事务方式运行，不受外部事务的影响。</span></li><li><span>MANDATORY：要求当前存在事务，如果没有事务，则抛出异常。多个事务方法必须在事务中运行，如果外部没有事务，则抛出异常。</span></li><li><span>NEVER：要求当前不存在事务，如果存在事务，则抛出异常。多个事务方法必须在非事务中运行，如果外部存在事务，则抛出异常。</span></li><li><span>NESTED：如果当前存在事务，则在嵌套事务中运行。如果没有事务，则新建一个事务。嵌套事务是外部事务的子事务，可以回滚或提交独立于外部事务的操作。</span></li></ol><p><span>		</span><strong><span>通过设置不同的事务传播机制，可以灵活地控制事务的行为。在多个事务方法相互调用的场景中，根据业务需求选择合适的传播行为，确保事务的一致性和隔离性。</span></strong></p><p><span>		</span><span>Spring 默认的事务传播行为是 PROPAFATION_REQUIRED，它适合绝大多数情况。</span></p><h3 id='34-声明式事务实现原理'><span>3.4 声明式事务实现原理</span></h3><p><span>		</span><span>声明式事务是通过AOP（面向切面编程）实现的。在Spring框架中，</span><strong><span>通过在方法上添加事务相关的注解（如</span><code>@Transactional</code><span>），就可以将方法声明为事务方法，并由Spring框架自动管理事务的提交、回滚等操作。</span></strong></p><p><span>实现声明式事务的原理如下：</span></p><ol start='' ><li><span>AOP代理：Spring利用AOP代理机制，将声明了事务的方法进行拦截。</span></li><li><span>事务切面：在AOP代理中，将事务管理相关的逻辑封装到事务切面中。</span></li><li><span>事务切点：事务切面定义了一个或多个切点，用于匹配需要进行事务管理的方法。</span></li><li><span>事务通知：在切点匹配的方法执行前后，事务切面会插入事务通知，用于管理事务的开启、提交、回滚等操作。</span></li><li><span>事务管理器：事务通知会委托给事务管理器执行实际的事务操作。事务管理器负责开启事务、提交事务、回滚事务等操作，并与底层的数据库事务进行交互。</span></li><li><span>事务属性解析：在解析事务注解时，Spring会根据注解的属性值，解析出事务的传播行为、隔离级别、超时时间等信息，并传递给事务管理器。</span></li></ol><p><span>		</span><span>总结起来，声明式事务的实现原理是通过AOP代理机制，在方法执行前后插入事务通知，并委托给事务管理器处理实际的事务操作。通过注解方式声明事务的属性，Spring可以解析注解并将事务属性传递给事务管理器，从而实现对事务的自动管理和控制。</span><strong><span>这种方式使得开发人员无需显式编写事务管理的代码，简化了事务处理的过程。</span></strong></p><h3 id='35-声明式事务在哪种情况下会失效'><span>3.5 声明式事务在哪种情况下会失效？</span></h3><p><strong><span>1、@Transactional 应用在非 public 修饰的方法上</span></strong></p><p><span>		</span><span>如果 Transactional 注解应用在非 public 修饰的方法上，Transactional 将会失效。</span></p><p><span>		</span><span>是因为在 Spring AOP 代理时，TransactionInterceptor （事务拦截器）在目标方法执行前后进行拦截，DynamicAdvisedInterceptor（CglibAopProxy 的内部类）的 intercept 方法 或 JdkDynamicAopProxy 的 invoke 方法会间接调用 AbstractFallbackTransactionAttributeSource 的 </span><strong><span>computeTransactionAttribute</span></strong><span>方法，</span><strong><span>获取 Transactional 注解的事务配置信息。</span></strong></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span> <span class="cm-variable">TransactionAttribute</span> <span class="cm-def">computeTransactionAttribute</span>(<span class="cm-variable">Method</span> <span class="cm-variable">method</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-variable">targetClass</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Don't allow no-public methods as required.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">allowPublicMethodsOnly</span>() <span class="cm-operator">&amp;&amp;</span> <span class="cm-operator">!</span><span class="cm-variable">Modifier</span>.<span class="cm-variable">isPublic</span>(<span class="cm-variable">method</span>.<span class="cm-variable">getModifiers</span>())) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>		</span><span>此方法会检查目标方法的修饰符是否为 public，不是 public 则不会获取@Transactional 的属性配置信息。那么该事务注解也就失效了</span></p><p><strong><span>2、@Transactional 注解属性 propagation 设置错误</span></strong></p><ul><li><span>TransactionDefinition.PROPAGATION_SUPPORTS：如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。</span></li><li><span>TransactionDefinition.PROPAGATION_NOT_SUPPORTED：以非事务方式运行，如果当前存在事务，则把当前事务挂起。</span></li><li><span>TransactionDefinition.PROPAGATION_NEVER：以非事务方式运行，如果当前存在事务，则抛出异常。</span></li></ul><p><strong><span>3、@Transactional 注解属性 rollbackFor 设置错误</span></strong></p><p><span>		</span><span>rollbackFor 可以指定能够触发事务回滚的异常类型。Spring 默认抛出了未检查 unchecked 异常（继承自 RuntimeException 的异常）或者 Error 才回滚事务，其他异常不会触发回滚事务。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-04053b02-3264-4d7f-b868-560a0333f08d.png" referrerpolicy="no-referrer" alt="Spring默认支持的异常回滚"><span>																					</span><span>Spring默认支持的异常回滚</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 希望自定义的异常可以进行回滚</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span>(<span class="cm-variable">propagation</span><span class="cm-operator">=</span> <span class="cm-variable">Propagation</span>.<span class="cm-variable">REQUIRED</span>, <span class="cm-variable">rollbackFor</span><span class="cm-operator">=</span> <span class="cm-variable">MyException</span>.<span class="cm-keyword">class</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>		</span><span>若在目标方法中抛出的异常是 rollbackFor 指定的异常的子类，事务同样会回滚。</span></p><p><strong><span>4、同一个类中方法调用，导致@Transactional 失效</span></strong></p><p><span>		</span><span>开发中避免不了会对同一个类里面的方法调用，比如有一个类 Test，它的一个方法 A，A 再调用本类的方法 B（不论方法 B 是用 public 还是 private 修饰），但方法 A 没有声明注解事务，而 B 方法有。</span><strong><span>则外部调用方法 A 之后，方法 B 的事务是不会起作用的。这也是经常犯错误的一个地方。</span></strong></p><p><span>那为啥会出现这种情况？其实这还是由于使用 Spring AOP 代理造成的，</span><strong><span>因为只有当事务方法被当前类以外的代码调用时，才会由 Spring 生成的代理对象来管理。</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">//@Transactional</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-meta">@GetMapping</span>(<span class="cm-string">"/test"</span>)</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-keyword">private</span> <span class="cm-variable-3">Integer</span> <span class="cm-def">A</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">Exception</span> {</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">CityInfoDict</span> <span class="cm-variable">cityInfoDict</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CityInfoDict</span>();</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cityInfoDict</span>.<span class="cm-variable">setCityName</span>(<span class="cm-string">"2"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">* B 插入字段为 3的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">*/</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">this</span>.<span class="cm-variable">insertB</span>();</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* A 插入字段为 2的数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">insert</span> <span class="cm-operator">=</span> <span class="cm-variable">cityInfoDictMapper</span>.<span class="cm-variable">insert</span>(<span class="cm-variable">cityInfoDict</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">insert</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Transactional</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Integer</span> <span class="cm-def">insertB</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">Exception</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">CityInfoDict</span> <span class="cm-variable">cityInfoDict</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CityInfoDict</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cityInfoDict</span>.<span class="cm-variable">setCityName</span>(<span class="cm-string">"3"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cityInfoDict</span>.<span class="cm-variable">setParentCityId</span>(<span class="cm-number">3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">cityInfoDictMapper</span>.<span class="cm-variable">insert</span>(<span class="cm-variable">cityInfoDict</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 627px;"></div><div class="CodeMirror-gutters" style="display: none; height: 627px;"></div></div></div></pre><p><span>这种情况是最常见的一种@Transactional 注解失效场景</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">Integer</span> <span class="cm-def">A</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">Exception</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">insert</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">CityInfoDict</span> <span class="cm-variable">cityInfoDict</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CityInfoDict</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cityInfoDict</span>.<span class="cm-variable">setCityName</span>(<span class="cm-string">"2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cityInfoDict</span>.<span class="cm-variable">setParentCityId</span>(<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* A 插入字段为 2的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insert</span> <span class="cm-operator">=</span> <span class="cm-variable">cityInfoDictMapper</span>.<span class="cm-variable">insert</span>(<span class="cm-variable">cityInfoDict</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* B 插入字段为 3的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b</span>.<span class="cm-variable">insertB</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 497px;"></div><div class="CodeMirror-gutters" style="display: none; height: 497px;"></div></div></div></pre><p><span>如果 B 方法内部抛了异常，而 A 方法此时 try catch 了 B 方法的异常，那这个事务就不能正常回滚了，会抛出异常：</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0352px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">transaction</span>.<span class="cm-variable">UnexpectedRollbackException</span>: <span class="cm-variable">Transaction</span> <span class="cm-variable">rolled</span> <span class="cm-variable">back</span> <span class="cm-variable">because</span> <span class="cm-variable">it</span> <span class="cm-variable">has</span> <span class="cm-variable">been</span> <span class="cm-variable">marked</span> <span class="cm-variable">as</span> <span class="cm-variable">rollback</span><span class="cm-operator">-</span><span class="cm-variable">only</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><strong><span>补充：</span></strong></p><p><strong><span>@Transactional 注解有哪些属性？</span></strong></p><p><code>@Transactional</code><span>注解是Spring框架提供的用于声明事务属性的注解，它具有多个属性用于配置事务的行为。下面是一些常用的</span><code>@Transactional</code><span>注解属性：</span></p><ol start='' ><li><code>value</code><span>：用于指定事务管理器的名称或ID，用于确定使用哪个事务管理器来管理事务，默认为空。</span></li><li><code>propagation</code><span>：用于指定事务的传播行为，即事务方法如何在其他事务中运行。可选值有</span><code>REQUIRED</code><span>、</span><code>REQUIRES_NEW</code><span>、</span><code>SUPPORTS</code><span>、</span><code>NOT_SUPPORTED</code><span>、</span><code>MANDATORY</code><span>、</span><code>NEVER</code><span>、</span><code>NESTED</code><span>，默认值为</span><code>REQUIRED</code><span>。</span></li><li><code>isolation</code><span>：用于指定事务的隔离级别，即事务并发操作时的隔离程度。可选值有</span><code>DEFAULT</code><span>、</span><code>READ_UNCOMMITTED</code><span>、</span><code>READ_COMMITTED</code><span>、</span><code>REPEATABLE_READ</code><span>、</span><code>SERIALIZABLE</code><span>，默认值为</span><code>DEFAULT</code><span>。</span></li><li><code>timeout</code><span>：用于指定事务超时时间，单位为秒。如果事务执行时间超过指定的超时时间，事务将被强制回滚，默认值为-1，表示不设置超时。</span></li><li><code>readOnly</code><span>：用于指定事务是否为只读事务，即事务中是否允许修改数据库。如果设置为</span><code>true</code><span>，表示事务只读，不进行数据库修改操作，默认值为</span><code>false</code><span>。</span></li><li><code>rollbackFor</code><span>：用于指定在哪些异常类型下事务需要回滚。可以指定一个或多个异常类型，当抛出指定的异常类型时，事务将回滚。</span></li><li><strong><code>noRollbackFor</code><span>：用于指定在哪些异常类型下事务不需要回滚。可以指定一个或多个异常类型，当抛出指定的异常类型时，事务不会回滚。</span></strong></li></ol><p><span>		</span><strong><span>这些是</span><code>@Transactional</code><span>注解常用的属性，通过对这些属性的配置，可以灵活地控制事务的传播行为、隔离级别、超时时间、只读状态等。根据具体需求，可以选择适当的属性配置来满足业务需求。</span></strong></p><p><strong><span>举例说明事务注解？</span></strong></p><p><span>以下是几个常见的使用事务注解</span><code>@Transactional</code><span>的示例：</span></p><ol start='' ><li><span>基本示例：</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">saveUser</span>(<span class="cm-variable">User</span> <span class="cm-variable">user</span>) {</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">userRepository</span>.<span class="cm-variable">save</span>(<span class="cm-variable">user</span>);</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>		</span><span>在上述示例中，</span><code>saveUser</code><span>方法标记了</span><code>@Transactional</code><span>注解，表示该方法是一个事务方法。在方法执行期间，如果发生异常，则事务会回滚，否则会提交事务。</span></p><ol start='2' ><li><span>指定回滚异常：</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span>(<span class="cm-variable">rollbackFor</span> <span class="cm-operator">=</span> {<span class="cm-variable">SQLException</span>.<span class="cm-keyword">class</span>, <span class="cm-variable">DataAccessException</span>.<span class="cm-keyword">class</span>})</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">updateUser</span>(<span class="cm-variable">User</span> <span class="cm-variable">user</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">userRepository</span>.<span class="cm-variable">update</span>(<span class="cm-variable">user</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>		</span><span>在上述示例中，</span><code>updateUser</code><span>方法标记了</span><code>@Transactional</code><span>注解，并通过</span><code>rollbackFor</code><span>属性指定了异常类型</span><code>SQLException.class</code><span>和</span><code>DataAccessException.class</code><span>。如果方法中抛出了这两种异常之一，事务将回滚。</span></p><ol start='3' ><li><span>设置事务传播行为：</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span>(<span class="cm-variable">propagation</span> <span class="cm-operator">=</span> <span class="cm-variable">Propagation</span>.<span class="cm-variable">REQUIRES_NEW</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">transferMoney</span>(<span class="cm-variable">Account</span> <span class="cm-variable">fromAccount</span>, <span class="cm-variable">Account</span> <span class="cm-variable">toAccount</span>, <span class="cm-variable">BigDecimal</span> <span class="cm-variable">amount</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 业务逻辑</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>		</span><span>在上述示例中，</span><code>transferMoney</code><span>方法标记了</span><code>@Transactional</code><span>注解，并通过</span><code>propagation</code><span>属性设置事务的传播行为为</span><code>Propagation.REQUIRES_NEW</code><span>。这意味着无论当前是否存在事务，该方法都会开启一个新的事务进行操作。</span></p><ol start='4' ><li><span>设置事务超时时间：</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Transactional</span>(<span class="cm-variable">timeout</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">longRunningOperation</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 长时间运行的业务逻辑</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 105px;"></div><div class="CodeMirror-gutters" style="display: none; height: 105px;"></div></div></div></pre><p><span>		</span><span>在上述示例中，</span><code>longRunningOperation</code><span>方法标记了</span><code>@Transactional</code><span>注解，并通过</span><code>timeout</code><span>属性设置事务的超时时间为10秒。如果方法的执行时间超过了指定的超时时间，事务将被强制回滚。</span></p><p><span>		</span><span>这些示例展示了不同情况下使用</span><code>@Transactional</code><span>注解的方式，通过配置不同的属性可以灵活地控制事务的行为和特性。根据具体的业务需求，可以选择适当的注解属性进行配置。</span></p><p>&nbsp;</p><h2 id='4-mvc'><span>4 MVC</span></h2><h3 id='41-spring-mvc的核心组件'><span>4.1 Spring MVC的核心组件</span></h3><ol start='' ><li><strong><span>DispatcherServlet</span></strong><span>：前置控制器，是整个流程控制的</span><strong><span>核心</span></strong><span>，控制其他组件的执行，进行统一调度，降低组件之间的耦合性，相当于总指挥。</span></li><li><strong><span>Handler</span></strong><span>：处理器，完成具体的业务逻辑，相当于 Servlet 或 Action。</span></li><li><strong><span>HandlerMapping</span></strong><span>：DispatcherServlet 接收到请求之后，通过 HandlerMapping 将不同的请求映射到不同的 Handler。</span></li><li><strong><span>HandlerInterceptor</span></strong><span>：处理器拦截器，是一个接口，如果需要完成一些拦截处理，可以实现该接口。</span></li><li><strong><span>HandlerExecutionChain</span></strong><span>：处理器执行链，包括两部分内容：Handler 和 HandlerInterceptor（系统会有一个默认的 HandlerInterceptor，如果需要额外设置拦截，可以添加拦截器）。</span></li><li><strong><span>HandlerAdapter</span></strong><span>：处理器适配器，Handler 执行业务方法之前，需要进行一系列的操作，包括表单数据的验证、数据类型的转换、将表单数据封装到 JavaBean 等，这些操作都是由 HandlerApater 来完成，开发者只需将注意力集中业务逻辑的处理上，DispatcherServlet 通过 HandlerAdapter 执行不同的 Handler。</span></li><li><strong><span>ModelAndView</span></strong><span>：装载了模型数据和视图信息，作为 Handler 的处理结果，返回给 DispatcherServlet。</span></li><li><strong><span>ViewResolver</span></strong><span>：视图解析器，DispatcheServlet 通过它将逻辑视图解析为物理视图，最终将渲染结果响应给客户端。</span></li></ol><p><strong><span>Spring MVC的核心组件包括以下几个部分：</span></strong></p><ol start='' ><li><span>DispatcherServlet（调度器）：DispatcherServlet是整个Spring MVC框架的核心，它是前端控制器（Front Controller）的实现。它接收所有的客户端请求并进行分发，将请求发送给相应的处理器（Handler）进行处理。</span></li><li><span>HandlerMapping（处理器映射）：HandlerMapping负责将请求映射到对应的处理器（Handler），根据请求的URL、请求方法等信息找到合适的处理器。</span></li><li><span>HandlerAdapter（处理器适配器）：HandlerAdapter负责将请求交给处理器进行处理，它根据不同的处理器类型选择相应的适配器进行处理。</span></li><li><span>Handler（处理器）：Handler是实际处理请求的组件，它可以是Controller类或者实现了特定接口的类。Handler负责处理请求并生成响应。</span></li><li><span>ViewResolver（视图解析器）：ViewResolver负责将处理器生成的模型数据和视图进行整合，找到合适的视图进行展示。</span></li><li><span>View（视图）：View是最终将处理结果展示给用户的组件，它可以是JSP、HTML、JSON、XML等形式的视图。</span></li><li><span>Model（模型）：Model负责封装处理器生成的数据，包括将处理结果传递给视图进行展示。</span></li><li><span>Interceptor（拦截器）：Interceptor用于在请求的处理过程中进行拦截和处理，可以在请求前后执行一些预处理和后处理的逻辑。</span></li></ol><p><strong><span>以上是Spring MVC框架的核心组件，它们协同工作，实现了请求的分发、处理和响应的过程。通过配置和组合这些组件，可以构建出功能强大的Web应用程序。</span></strong></p><h3 id='42-spring-mvc-的工作流程'><span>4.2 Spring MVC 的工作流程？</span></h3><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-e29a122b-db07-48b8-8289-7251032e87a1.png" referrerpolicy="no-referrer" alt="Spring MVC的工作流程"></p><ol start='' ><li><span>客户端向服务端发送一次请求，这个请求会先到前端控制器 DispatcherServlet(也叫中央控制器)。</span></li><li><span>DispatcherServlet 接收到请求后会调用 HandlerMapping 处理器映射器。由此得知，该请求该由哪个 Controller 来处理（并未调用 Controller，只是得知）</span></li><li><span>DispatcherServlet 调用 HandlerAdapter 处理器适配器，告诉处理器适配器应该要去执行哪个 Controller</span></li><li><span>HandlerAdapter 处理器适配器去执行 Controller 并得到 ModelAndView(数据和视图)，并层层返回给 DispatcherServlet</span></li><li><span>DispatcherServlet 将 ModelAndView 交给 ViewReslover 视图解析器解析，然后返回真正的视图。</span></li><li><span>DispatcherServlet 将模型数据填充到视图中</span></li><li><span>DispatcherServlet 将结果响应给客户端进行渲染</span></li></ol><p><strong><span>Spring MVC</span></strong><span> 虽然整体流程复杂，但是实际开发中很简单，大部分的组件不需要开发人员创建和管理，只需要通过配置文件的方式完成配置即可，真正需要开发人员进行处理的只有 </span><strong><span>Handler（Controller）</span></strong><span> 、</span><strong><span>View</span></strong><span> 、</span><strong><span>Model</span></strong><span>。</span></p><p><span>当然我们现在大部分的开发都是前后端分离，Restful 风格接口，后端只需要返回 Json 数据就行了。</span></p><h3 id='43-springmvc-restful-风格的接口的流程是什么样的呢'><span>4.3 SpringMVC Restful 风格的接口的流程是什么样的呢？</span></h3><p><span>PS:这是一道全新的八股，毕竟 ModelAndView 这种方式应该没人用了吧？现在都是前后端分离接口，八股也该更新换代了。</span></p><p><span>我们都知道 Restful 接口，响应格式是 json，这就用到了一个常用注解：</span><strong><span>@ResponseBody</span></strong></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@GetMapping</span>(<span class="cm-string">"/user"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@ResponseBody</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">User</span> <span class="cm-def">user</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-number">1</span>,<span class="cm-string">"张三"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 131px;"></div><div class="CodeMirror-gutters" style="display: none; height: 131px;"></div></div></div></pre><p><span>加入了这个注解后，整体的流程上和使用 ModelAndView 大体上相同，但是细节上有一些不同：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-2da963a0-5da9-4b3a-aafd-fd8dbc7e1807.png" referrerpolicy="no-referrer" alt="Spring MVC Restful请求响应示意图"></p><ol start='' ><li><p><span>客户端向服务端发送一次请求，这个请求会先到前端控制器 DispatcherServlet</span></p></li><li><p><span>DispatcherServlet 接收到请求后会调用 HandlerMapping 处理器映射器。由此得知，该请求该由哪个 Controller 来处理</span></p></li><li><p><span>DispatcherServlet 调用 HandlerAdapter 处理器适配器，告诉处理器适配器应该要去执行哪个 Controller</span></p></li><li><p><span>Controller 被封装成了 ServletInvocableHandlerMethod，HandlerAdapter 处理器适配器去执行 invokeAndHandle 方法，完成对 Controller 的请求处理</span></p></li><li><p><span>HandlerAdapter 执行完对 Controller 的请求，会调用 HandlerMethodReturnValueHandler 去处理返回值，主要的过程：</span></p><p><span>5.1. 调用 RequestResponseBodyMethodProcessor，创建 ServletServerHttpResponse（Spring 对原生 ServerHttpResponse 的封装）实例</span></p><p><span>5.2.使用 HttpMessageConverter 的 write 方法，将返回值写入 ServletServerHttpResponse 的 OutputStream 输出流中</span></p><p><span>5.3.在写入的过程中，会使用 JsonGenerator（默认使用 Jackson 框架）对返回值进行 Json 序列化</span></p></li><li><p><span>执行完请求后，返回的 ModealAndView 为 null，ServletServerHttpResponse 里也已经写入了响应，所以不用关心 View 的处理</span></p></li></ol><h2 id='5-spring-boot'><span>5 Spring Boot</span></h2><p>&nbsp;</p><h3 id='51-spring-boot是什么有哪些优点'><span>5.1 Spring Boot是什么？有哪些优点？</span></h3><p><span>Spring Boot 基于 Spring 开发，Spirng Boot 本身并不提供 Spring 框架的核心特性以及扩展功能，只是用于快速、敏捷地开发新一代基于 Spring 框架的应用程序。它并不是用来替代 Spring 的解决方案，而是和 Spring 框架紧密结合用于提升 Spring 开发者体验的工具。</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-d9164ee6-5c86-4313-8fd9-efb9acfa5f0b.png" referrerpolicy="no-referrer" alt="SpringBoot图标"></p><p><span>																								</span><span>SpringBoot图标</span></p><p><span>Spring Boot 以</span><code>约定大于配置</code><span>核心思想开展工作，相比 Spring 具有如下优势：</span></p><ol start='' ><li><span>Spring Boot 可以快速创建独立的 Spring 应用程序。</span></li><li><span>Spring Boot 内嵌了如 Tomcat，Jetty 和 Undertow 这样的容器，也就是说可以直接跑起来，用不着再做部署工作了。</span></li><li><span>Spring Boot 无需再像 Spring 一样使用一堆繁琐的 xml 文件配置。</span></li><li><span>Spring Boot 可以自动配置(核心)Spring。SpringBoot 将原有的 XML 配置改为 Java 配置，将 bean 注入改为使用注解注入的方式(@Autowire)，并将多个 xml、properties 配置浓缩在一个 appliaction.yml 配置文件中。</span></li><li><span>Spring Boot 提供了一些现有的功能，如量度工具，表单数据验证以及一些外部配置这样的一些第三方功能。</span></li><li><span>Spring Boot 可以快速整合常用依赖（开发库，例如 spring-webmvc、jackson-json、validation-api 和 tomcat 等），提供的 POM 可以简化 Maven 的配置。当我们引入核心依赖时，SpringBoot 会自引入其他依赖。</span></li></ol><p><strong><span>补充：</span></strong></p><p><span>在Spring和Spring Boot中，都可以使用依赖注入（Dependency Injection）来实现Bean的注入。</span></p><p><span>在Spring中，常用的注入方式包括：</span></p><ol start='' ><li><span>构造函数注入（Constructor Injection）：通过在类的构造函数上使用</span><code>@Autowired</code><span>注解，让Spring容器自动根据参数类型进行注入。</span></li><li><span>属性注入（Field Injection）：通过在类的属性上使用</span><code>@Autowired</code><span>注解，让Spring容器自动将匹配的Bean注入到属性中。</span></li><li><span>方法注入（Method Injection）：通过在类的方法上使用</span><code>@Autowired</code><span>注解，让Spring容器自动根据参数类型进行注入。</span></li></ol><p><span>在Spring Boot中，除了可以使用上述的注入方式外，还提供了更方便的注解方式：</span></p><ol start='' ><li><code>@Autowired</code><span>注解：可以用于构造函数、属性和方法上，实现自动注入。</span></li><li><code>@Resource</code><span>注解：与</span><code>@Autowired</code><span>类似，也可以用于构造函数、属性和方法上，实现自动注入。</span></li><li><code>@Inject</code><span>注解：与</span><code>@Autowired</code><span>功能类似，可以用于构造函数、属性和方法上，实现自动注入。</span></li></ol><p><span>Spring Boot会自动扫描并创建Bean，然后根据注解自动将依赖注入到需要的地方。通过这些注入方式，可以方便地管理和使用Bean，并解耦应用程序的组件之间的依赖关系。</span></p><p><span>需要注意的是，在使用注解进行Bean注入时，需要确保Spring或Spring Boot应用程序已正确配置和启动，并且目标Bean已经被Spring容器管理。</span></p><h3 id='52-springboot-自动配置原理了解吗'><span>5.2 SpringBoot 自动配置原理了解吗？</span></h3><p><span>Spring Boot的自动配置是指在应用程序启动时，根据项目的依赖和配置情况，自动为应用程序提供一系列默认的配置和功能。它的目的是减少开发者在配置和集成各种框架和组件时的工作量，提供一种开箱即用的开发体验。</span></p><p><span>Spring Boot的自动配置是通过条件注解和默认配置实现的。它利用条件注解（</span><code>@Conditional</code><span>）来根据特定的条件判断是否需要进行自动配置。条件注解可以根据类的存在性、Bean的存在性、配置属性的值等来决定是否生效。根据条件注解的判断结果，Spring Boot会自动加载并配置相应的Bean和组件，从而为应用程序提供默认的功能和特性。</span></p><p><span>自动配置可以涵盖各个方面，例如数据库连接、Web服务器配置、日志配置、消息队列配置等。当我们引入相关的依赖时，Spring Boot会根据依赖自动配置相应的功能，无需手动编写大量的配置代码。同时，Spring Boot还提供了外部的配置文件（如</span><code>application.properties</code><span>或</span><code>application.yml</code><span>），开发者可以在配置文件中覆盖默认的自动配置，以满足特定的需求。</span></p><p><span>总的来说，Spring Boot的自动配置通过条件注解和默认配置，减少了开发者的配置工作，提供了一种快速构建和运行应用程序的方式。开发者可以专注于业务逻辑的实现，而无需过多关注底层框架和组件的集成和配置。</span></p><p><span>SpringBoot 开启自动配置的注解是</span><code>@EnableAutoConfiguration</code><span> ，启动类上的注解</span><code>@SpringBootApplication</code><span>是一个复合注解，包含了@EnableAutoConfiguration：</span></p><p><img src="Spring%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%8820230701%EF%BC%89.assets/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png" referrerpolicy="no-referrer" alt="SpringBoot自动配置原理"><span>SpringBoot自动配置原理</span></p><ul><li><p><code>EnableAutoConfiguration</code><span> 只是一个简单的注解，自动装配核心功能的实现实际是通过 </span><code>AutoConfigurationImportSelector</code><span>类</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0703px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@AutoConfigurationPackage</span> <span class="cm-comment">//将main同级的包下的所有组件注册到容器中</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Import</span>({<span class="cm-variable">AutoConfigurationImportSelector</span>.<span class="cm-keyword">class</span>}) <span class="cm-comment">//加载自动装配类 xxxAutoconfiguration</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">@interface</span> <span class="cm-def">EnableAutoConfiguration</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="cm-operator">=</span> <span class="cm-string">"spring.boot.enableautoconfiguration"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Class</span><span class="cm-operator">&lt;?&gt;</span>[] <span class="cm-variable">exclude</span>() <span class="cm-keyword">default</span> {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span>[] <span class="cm-variable">excludeName</span>() <span class="cm-keyword">default</span> {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 235px;"></div><div class="CodeMirror-gutters" style="display: none; height: 235px;"></div></div></div></pre></li><li><p><code>AutoConfigurationImportSelector</code><span>实现了</span><code>ImportSelector</code><span>接口，这个接口的作用就是收集需要导入的配置类，配合</span><code>@Import(）</code><span>就可以将相应的类导入到 Spring 容器中</span></p></li><li><p><span>获取注入类的方法是 selectImports()，它实际调用的是</span><code>getAutoConfigurationEntry</code><span>，这个方法是获取自动装配类的关键，主要流程可以分为这么几步：</span></p><ol start='' ><li><span>获取注解的属性，用于后面的排除</span></li><li><strong><span>获取所有需要自动装配的配置类的路径</span></strong><span>：这一步是最关键的，从 META-INF/spring.factories 获取自动配置类的路径</span></li><li><span>去掉重复的配置类和需要排除的重复类，把需要自动加载的配置类的路径存储起来</span></li></ol></li></ul><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11.0352px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">protected</span> <span class="cm-variable">AutoConfigurationImportSelector</span>.<span class="cm-variable">AutoConfigurationEntry</span> <span class="cm-def">getAutoConfigurationEntry</span>(<span class="cm-variable">AnnotationMetadata</span> <span class="cm-variable">annotationMetadata</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-keyword">this</span>.<span class="cm-variable">isEnabled</span>(<span class="cm-variable">annotationMetadata</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">EMPTY_ENTRY</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//1.获取到注解的属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">AnnotationAttributes</span> <span class="cm-variable">attributes</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getAttributes</span>(<span class="cm-variable">annotationMetadata</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//2.获取需要自动装配的所有配置类，读取META-INF/spring.factories，获取自动配置类路径</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">configurations</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getCandidateConfigurations</span>(<span class="cm-variable">annotationMetadata</span>, <span class="cm-variable">attributes</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//3.1.移除重复的配置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">configurations</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">removeDuplicates</span>(<span class="cm-variable">configurations</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//3.2.处理需要排除的配置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">exclusions</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getExclusions</span>(<span class="cm-variable">annotationMetadata</span>, <span class="cm-variable">attributes</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">checkExcludedClasses</span>(<span class="cm-variable">configurations</span>, <span class="cm-variable">exclusions</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">configurations</span>.<span class="cm-variable">removeAll</span>(<span class="cm-variable">exclusions</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">configurations</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getConfigurationClassFilter</span>().<span class="cm-variable">filter</span>(<span class="cm-variable">configurations</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">fireAutoConfigurationImportEvents</span>(<span class="cm-variable">configurations</span>, <span class="cm-variable">exclusions</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">AutoConfigurationImportSelector</span>.<span class="cm-variable">AutoConfigurationEntry</span>(<span class="cm-variable">configurations</span>, <span class="cm-variable">exclusions</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 575px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><p><span>以下是一些常见的自动装配的示例：</span></p><ol start='' ><li><span>数据库连接：在Spring Boot中，可以通过添加相关的数据库依赖（如Spring Data JPA、MyBatis等）和配置文件（如</span><code>application.properties</code><span>或</span><code>application.yml</code><span>）来实现数据库连接的自动装配。Spring Boot会根据配置的数据源信息和依赖的库，自动配置数据库连接池和数据源，并创建相应的</span><code>DataSource</code><span> Bean供应用程序使用。</span></li><li><span>日志记录：Spring Boot默认集成了常见的日志框架，如Logback、Log4j等。通过添加相关的日志依赖，应用程序可以自动获得日志功能。Spring Boot会根据依赖和默认配置，自动配置日志记录器，并将日志输出到控制台或文件中。</span></li><li><span>Web开发：Spring Boot提供了Spring MVC的自动配置，可以快速构建Web应用程序。通过添加相关的Web依赖，应用程序可以自动获得Web开发所需的功能。Spring Boot会自动配置请求映射、视图解析器、异常处理等，并提供一些默认的Web配置。</span></li><li><span>缓存管理：Spring Boot提供了对常见缓存框架（如Ehcache、Redis等）的自动配置支持。通过添加相关的缓存依赖，应用程序可以自动获得缓存管理的功能。Spring Boot会根据依赖和配置，自动配置缓存管理器，并提供缓存注解（如</span><code>@Cacheable</code><span>、</span><code>@CacheEvict</code><span>等）用于缓存方法的结果。</span></li><li><span>消息队列：Spring Boot提供了对消息队列框架（如RabbitMQ、Kafka等）的自动配置支持。通过添加相关的消息队列依赖，应用程序可以自动获得消息队列的功能。Spring Boot会根据依赖和配置，自动配置消息队列的连接工厂、消息监听器容器等。</span></li></ol><p><span>这些只是一些常见的自动装配示例，Spring Boot提供了更广泛的自动配置功能，涵盖了各种常用的框架和组件。通过使用Spring Boot，开发者可以减少手动配置的工作量，快速构建和运行应用程序。</span></p><h3 id='53-springboot-启动原理'><span>5.3 Springboot 启动原理</span></h3><p><span>Spring Boot的启动原理可以概括为以下几个步骤：</span></p><ol start='' ><li><span>加载Spring Boot启动类：Spring Boot应用程序的入口是一个Java类，通常被标记为</span><code>@SpringBootApplication</code><span>注解。在启动过程中，Java虚拟机首先加载这个启动类。</span></li><li><span>启动自动配置：Spring Boot会自动扫描并加载classpath下的所有依赖，根据依赖的情况自动配置应用程序的各个组件。它通过条件注解和默认配置实现自动配置的功能。</span></li><li><span>创建Spring应用上下文：Spring Boot会根据自动配置的结果创建一个Spring应用上下文（ApplicationContext）。应用上下文是Spring的核心容器，负责管理和协调Bean的创建和管理。</span></li><li><span>执行生命周期回调：在Spring应用上下文创建之后，Spring Boot会执行一系列的生命周期回调方法。这些方法可以用于自定义一些初始化操作，如加载配置、注册Bean等。</span></li><li><span>启动内嵌的Web服务器：如果应用程序依赖了Spring Web相关的库，Spring Boot会自动配置并启动内嵌的Web服务器，如Tomcat或Undertow。它会扫描并装配控制器类，处理HTTP请求，并根据配置的路由规则进行请求分发。</span></li><li><span>运行应用程序：一旦内嵌的Web服务器启动成功，应用程序就可以响应来自客户端的HTTP请求，并进行相应的处理。同时，Spring Boot还可以自动加载和配置其他的组件，如数据库连接池、缓存管理器等。</span></li></ol><p><span>总的来说，Spring Boot的启动过程包括加载启动类、自动配置、创建应用上下文、执行生命周期回调、启动内嵌的Web服务器和运行应用程序。通过自动配置和默认约定，Spring Boot大大简化了应用程序的配置和部署过程，使得开发者可以更加专注于业务逻辑的实现。</span></p><p>&nbsp;</p></div></div>
</body>
</html>